# 入札者ヘッダー ユーザーアイコンメニュー実装プラン

## 概要

現在のBidderHeaderを以下のように改修します：
- ヘッダー右側に「利用可能ポイント表示」と「ユーザーアイコン（アバター）」を配置
- アイコンクリックでドロップダウンメニューを表示
- メニュー内にユーザー情報（名前、メール）とログアウトを含める
- デスクトップ・モバイル共通のドロップダウンスタイル（シンプル統一）

## 設計方針

### 1. ヘッダーレイアウトの最適化
- **左側**: ロゴ + タイトル
- **右側**: ナビゲーション（デスクトップのみ） + 利用可能ポイント + ユーザーアイコン
- ユーザー名・メール・ロールバッジはヘッダーから削除し、メニュー内に移動
- ログアウトボタンを削除し、メニュー内に統合

### 2. ポイント表示の視認性向上
- アイコンの左側に利用可能ポイントを常時表示
- 既存のPointsDisplayコンポーネントを活用
- 入札前にユーザーが即座に確認できる配置

### 3. シンプルで統一的なメニュー
- デスクトップ・モバイルで同じドロップダウンスタイル
- 実装済み機能のみ表示（将来機能は非表示）
- クリーンで直感的なUI

### 4. 控えめなアニメーション
- シンプルなスケール変化のみ
- オークションという真剣な場面にふさわしい落ち着いたデザイン

## コンポーネント構成

### 新規作成コンポーネント

1. **DropdownMenu.vue**（再利用可能なUIプリミティブ）
   - Radix Vueを使用してアクセシビリティを確保
   - ポータルレンダリングで適切なz-index管理
   - フォーカストラップとキーボードナビゲーション
   - @vueuse/coreでクリック外側検出

2. **UserDropdownMenu.vue**（入札者専用）
   - ユーザー情報セクション（アバター、名前、メール、ロールバッジ）
   - ポイント残高の視覚的階層表示
   - Lucideアイコン付きナビゲーションメニューアイテム
   - ローディング状態付きログアウト

### 変更コンポーネント

**BidderHeader.vue**:
- 独立したログアウトボタンを削除
- アバターをドロップダウントリガーでラップ
- インタラクティブなホバー/フォーカス状態を追加

## ヘッダーレイアウト（ログイン時）

```
┌────────────────────────────────────────────────────────────┐
│  🏇 リアルタイムオークション    [ナビ] [ポイント] [アイコン▼] │
└────────────────────────────────────────────────────────────┘
```

### 右側の配置順序（左から右へ）
1. **ナビゲーションリンク**（デスクトップのみ、md:以上）
   - オークション一覧

2. **利用可能ポイント表示**
   - 既存のPointsDisplayコンポーネントを使用
   - フォーマット: `💰 利用可能: 10,000 pts`
   - 白背景、グリーン強調、シャドウ付き

3. **ユーザーアイコン（ドロップダウントリガー）**
   - 円形グリーングラデーション（green-400 → green-600）
   - 頭文字表示
   - クリックでメニュー開閉

## ドロップダウンメニュー構造

```
┌─────────────────────────────────────┐
│  [アバター] 表示名                   │
│          user@email.com              │
│  ────────────────────────────────   │
│  🚪 ログアウト                      │
└─────────────────────────────────────┘
```

### セクション1: ユーザー情報
- **アバター**: 円形グリーングラデーション、頭文字
- **表示名**: 太字、グレー900、中サイズ
- **メールアドレス**: 通常、グレー500、小サイズ
- クリック不可、情報表示のみ

### セクション2: ログアウト（セパレーター後）
- **アイコン**: 🚪 LogOut（Lucide）
- **テキスト**: "ログアウト"、赤テキスト（red-600）
- **ホバー**: 赤背景（red-50）
- **ローディング状態**: スピナー + "ログアウト中..."表示

## ビジュアルデザイン

### メニューコンテナ
- 幅: 240px（コンパクト設計）
- 角丸: 8px（rounded-lg）
- シャドウ: 0 4px 12px rgba(0,0,0,0.15)
- パディング: 8px
- 白背景、グレーのボーダー（border-gray-200）
- アバターの右下に配置（right-0 top-full mt-2）

### アバターの状態（シンプル設計）

**通常時**:
- グリーングラデーション（green-400 → green-600）
- サイズ: 40px × 40px（h-10 w-10）
- 頭文字: 白色、セミボールド、小サイズ
- シャドウなし

**ホバー時**:
- スケール: 1.05（transform scale-105）
- トランジション: 200ms ease-out
- カーソル: pointer
- 回転なし（シンプル）

**メニューオープン時**:
- グリーンリング（2px、green-500）
- スケール: 1.05維持
- 背景グラデーション変更なし

**キーボードフォーカス時**:
- グリーンリング（2px、green-600）
- リングオフセット: 2px
- アウトライン: focus-visible対応

## アニメーション（シンプル設計）

### メニューオープン（150ms ease-out）
```
From: opacity 0, translateY(-4px), scale(0.98)
To: opacity 1, translateY(0), scale(1)
```

### メニュークローズ（100ms ease-in）
```
From: opacity 1, translateY(0), scale(1)
To: opacity 0, translateY(-4px), scale(0.98)
```

### アバターホバー（200ms ease-out）
```
scale: 1.0 → 1.05
（回転なし、シンプルなスケール変化のみ）
```

### ログアウトアイテムホバー
- 背景: transparent → red-50
- テキスト色: red-600 → red-700
- 時間: 150ms ease

## レスポンシブデザイン（統一スタイル）

### 全デバイス共通
- メニューはアバターの右下に固定（position: absolute）
- 240px固定幅
- アバターからのマージン: 8px（mt-2）
- 右端揃え（right: 0）
- z-index: 50（ヘッダーより上）

### デスクトップ（≥768px）
- ナビゲーションリンク表示
- ポイント表示 + アイコン
- メニュー位置: アバター右下

### タブレット（≥640px、<768px）
- ナビゲーションリンク非表示（モバイルメニュー利用）
- ポイント表示 + アイコン
- メニュー位置: アバター右下
- 画面右端はみ出し防止（right: 0）

### モバイル（<640px）
- ナビゲーションリンク非表示（モバイルメニュー利用）
- ポイント表示のフォントサイズ縮小またはアイコンのみ表示検討
- メニュー位置: アバター右下
- 画面右端はみ出し防止（right: 0、必要に応じてmax-width調整）

## アクセシビリティ

### キーボード操作
- **Tab**: アバターにフォーカス
- **Enter/Space**: メニュー開閉
- **Escape**: メニュー閉じる、アバターにフォーカス戻す
- **Tab（メニュー内）**: ログアウトボタンへフォーカス移動

### ARIA属性
```html
<button
  role="button"
  aria-haspopup="true"
  aria-expanded="true|false"
  aria-label="ユーザーメニューを開く"
>

<div
  role="menu"
  aria-orientation="vertical"
>

<button role="menuitem" aria-label="ログアウト">
```

### スクリーンリーダー対応
- アバターボタンに説明的なラベル
- ログアウトボタンに説明的なラベル
- フォーカス管理と視覚的インジケーター（green-600リング）
- メニューオープン/クローズ状態をaria-expandedで通知

### モーション低減対応
```css
@media (prefers-reduced-motion: reduce) {
  .dropdown-menu,
  .avatar-trigger {
    transition: opacity 100ms ease !important;
    transform: none !important;
  }
}
```

## アイコン使用

### Lucide Vue Next（既にインストール済み）
- **LogOut**: ログアウトボタン（18×18px、stroke-width: 2、text-red-600）
- **ChevronDown**: アバター横の下向き矢印（オプション、12×12px、メニュー開閉状態を視覚的に示す）

### SVGアイコン（既存コード流用）
- **ポイント表示のアイコン**: PointsDisplayコンポーネントの既存SVGを使用

## 実装フェーズ（簡素化版）

### フェーズ1: BidderHeaderの改修（1.5時間）
- [ ] ユーザー名・メール・ロールバッジをヘッダーから削除
- [ ] 独立したログアウトボタンを削除
- [ ] PointsDisplayコンポーネントをインポート・配置
- [ ] アバター部分をボタン化（クリックイベント追加）
- [ ] ドロップダウンメニュー開閉状態の管理（ref）

### フェーズ2: ドロップダウンメニューの実装（2時間）
- [ ] シンプルなドロップダウンメニューをBidderHeader内に実装
- [ ] v-ifでメニュー表示制御
- [ ] ユーザー情報セクション（アバター + 名前 + メール）
- [ ] セパレーター（border-top）
- [ ] ログアウトボタン（赤色、ローディング状態対応）
- [ ] クリック外側検出（@vueuse/core の onClickOutside）

### フェーズ3: スタイリング＆アニメーション（1.5時間）
- [ ] メニューコンテナスタイル（240px幅、シャドウ、角丸）
- [ ] アバターホバー・オープン状態スタイル
- [ ] メニュー開閉アニメーション（Transition）
- [ ] ログアウトボタンホバースタイル
- [ ] モーション低減対応

### フェーズ4: アクセシビリティ＆キーボード操作（1時間）
- [ ] ARIA属性（aria-haspopup, aria-expanded, aria-label）
- [ ] キーボードナビゲーション（Enter/Space, Escape）
- [ ] フォーカス管理（メニュー閉じる時にアバターへフォーカス戻す）
- [ ] フォーカス視覚的インジケーター（ring）

### フェーズ5: レスポンシブ調整＆テスト（1時間）
- [ ] モバイル・タブレット・デスクトップでの表示確認
- [ ] メニュー位置調整（画面右端はみ出し防止）
- [ ] ポイント表示のモバイル対応（フォントサイズ調整）
- [ ] クロスブラウザテスト（Chrome, Safari, Firefox）
- [ ] エッジケース確認（データ欠損、ポイント0、ログアウト失敗）

**総所要時間**: 約7時間

## エッジケース対応

1. **ポイントデータ欠損**: bidderAuthStore.user?.pointsがundefinedの場合、0 ptsと表示
2. **ログアウト失敗**: エラー時にconsole.error出力、メニューは閉じてユーザーに再試行を促す
3. **表示名欠損**: displayNameがない場合はemailを表示、両方ない場合は"ゲスト"と表示
4. **メニュー画面外**: 画面右端にメニューが収まるよう、right: 0で配置

## 変更ファイル一覧

### 変更（1ファイルのみ）
1. **`frontend/src/components/bidder/BidderHeader.vue`**
   - ユーザー名・メール・ロールバッジ・独立したログアウトボタンを削除
   - PointsDisplayコンポーネントをインポート・配置
   - アバターをボタン化、クリックでメニュー開閉
   - ドロップダウンメニューをコンポーネント内に直接実装
   - @vueuse/coreのonClickOutsideを使用
   - Transitionでメニューアニメーション
   - ARIA属性とキーボードナビゲーション対応

### 参照（変更なし）
2. **`frontend/src/components/bidder/PointsDisplay.vue`** - 既存のポイント表示コンポーネントを使用
3. **`frontend/src/stores/bidderAuthStore.js`** - ユーザーデータソース、ログアウトアクション

## 技術的な考慮事項

### シンプル設計の理由
- **再利用可能コンポーネント不要**: 現時点では入札者ヘッダーのみで使用するため、BidderHeader内に直接実装
- **Radix Vue不使用**: シンプルなメニューなので、v-if + Transition + onClickOutsideで十分
- **@vueuse/core活用**: onClickOutside（メニュー外クリック検出）のみ使用、既にインストール済み

### パフォーマンス最適化
- v-ifでメニューを遅延レンダリング（開くまで非表示）
- CSS transformsでGPUアクセラレーション（translate, scale）
- シンプルなアニメーション（150ms以内）
