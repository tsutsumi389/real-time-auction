# オークション作成画面（1.3.2）実装プラン

**作成日**: 2025年11月23日  
**対象画面**: オークション作成画面（Auction Creation）  
**パス**: `/admin/auctions/new`  
**権限**: auctioneer / system_admin  
**優先度**: 高（フェーズ1: 基本機能）

---

## 1. 概要

### 1.1 目的
主催者（auctioneer）およびシステム管理者（system_admin）が、新規オークションと商品を登録するための画面です。オークション基本情報の入力、商品情報の登録、メディアファイルのアップロードを一つの画面で完結させます。

**重要な設計方針**:
- **商品中心の設計**: 本システムは商品（items）が独立したオークションライフサイクルを持つ
- **オークションはコンテナ**: オークション（auctions）は複数商品を束ねる役割
- **段階的な登録**: オークション作成時は基本情報のみ、商品は別途追加可能

### 1.2 対象ユーザー
- **auctioneer（主催者）**: オークションと商品の作成が可能
- **system_admin（システム管理者）**: すべての機能にアクセス可能

### 1.3 主要機能
1. オークション基本情報の入力（タイトル、説明、開始日時）
2. 商品情報の登録（名前、説明、開始価格）
3. 商品の追加・削除
4. 表示順序の設定（▲▼ボタン）
5. バリデーション（必須項目チェック）
6. 一時保存機能（下書き保存）
7. 登録実行（status = 'pending'で作成）

**注意**: カテゴリ、詳細情報（metadata）、メディアアップロードは後の実装フェーズで追加予定

---

## 2. 画面レイアウト

### 2.1 画面構成

```
┌───────┬─────────────────────────────────────────────────────────────┐
│       │ [ロゴ] オークション作成                      [ログアウト]    │
│       ├─────────────────────────────────────────────────────────────┤
│ サイド│                                                             │
│ メニュー │ オークション作成                                             │
│       │                                                             │
│       │ ┌─────────────────────────────────────────────────────────┐ │
│       │ │ 基本情報                                                 │ │
│       │ │                                                         │ │
│       │ │ タイトル *                                               │ │
│       │ │ [_________________________________________________]     │ │
│       │ │                                                         │ │
│       │ │ 説明                                                    │ │
│       │ │ [_________________________________________________]     │ │
│       │ │ [_________________________________________________]     │ │
│       │ │ [_________________________________________________]     │ │
│       │ │                                                         │ │
│       │ └─────────────────────────────────────────────────────────┘ │
│       │                                                             │
│       │ ┌─────────────────────────────────────────────────────────┐ │
│       │ │ 商品情報                                 [+ 商品を追加]   │ │
│       │ │                                                         │ │
│       │ │ 商品 #1                                  [削除] [▲] [▼]  │ │
│       │ │ ┌───────────────────────────────────────────────────┐   │ │
│       │ │ │ 商品名 *                                           │   │ │
│       │ │ │ [_____________________________________________]   │   │ │
│       │ │ │                                                   │   │ │
│       │ │ │ 商品説明                                           │   │ │
│       │ │ │ [_____________________________________________]   │   │ │
│       │ │ │ [_____________________________________________]   │   │ │
│       │ │ │ [_____________________________________________]   │   │ │
│       │ │ └───────────────────────────────────────────────────┘   │ │
│       │ │                                                         │ │
│       │ │ 商品 #2                                  [削除] [▲] [▼]  │ │
│       │ │ (...同様の入力フィールド...)                              │ │
│       │ │                                                         │ │
│       │ └─────────────────────────────────────────────────────────┘ │
│       │                                                             │
│       │ [キャンセル]                    [下書き保存] [作成する]        │
│       │                                                             │
└───────┴─────────────────────────────────────────────────────────────┘
```

### 2.2 デザイン要件

- **レイアウト**: 縦長のフォーム、最大幅900px
- **セクション区切り**: カード形式、白い背景、影付き
- **入力フィールド**:
  - テキスト: 単一行、高さ40px
  - テキストエリア: 複数行、高さ120px
  - セレクトボックス: ドロップダウン形式
  - 日付ピッカー: カレンダー形式
- **ボタン**:
  - 作成ボタン: 青系（primary）、目立つ配置
  - 下書き保存ボタン: 灰色系（secondary）
  - キャンセルボタン: アウトライン形式
  - 削除ボタン: 赤系（destructive）、小サイズ
  - 商品追加ボタン: 緑系（success）
  - 順序変更ボタン: [▲][▼]ボタン形式
- **バリデーションエラー**: 赤いテキスト、フィールド下部に表示

---

## 3. 入力項目とバリデーション

### 3.1 オークション基本情報

#### 3.1.1 タイトル

| 項目 | 内容 |
|------|------|
| **ラベル** | タイトル * |
| **入力形式** | テキスト入力 |
| **プレースホルダー** | 例: 2025年春季競走馬セリ |
| **必須/任意** | 必須 |
| **最大文字数** | 200文字 |

**バリデーションルール:**
1. 空欄の場合: 「タイトルを入力してください」
2. 200文字を超える場合: 「タイトルは200文字以内で入力してください」

**バリデーションタイミング:**
- リアルタイム: フィールドからフォーカスが外れた時（onBlur）
- 送信時: 作成ボタンをクリックした時

#### 3.1.2 説明

| 項目 | 内容 |
|------|------|
| **ラベル** | 説明 |
| **入力形式** | テキストエリア（複数行） |
| **プレースホルダー** | オークションの概要を入力してください |
| **必須/任意** | 任意 |
| **最大文字数** | 2000文字 |

**バリデーションルール:**
1. 2000文字を超える場合: 「説明は2000文字以内で入力してください」

**バリデーションタイミング:**
- リアルタイム: フィールドからフォーカスが外れた時（onBlur）

#### 3.1.3 開始日時

| 項目 | 内容 |
|------|------|
| **ラベル** | 開始日時 |
| **入力形式** | datetime-local入力 |
| **プレースホルダー** | - |
| **必須/任意** | 任意 |
| **説明** | 入札者用一覧画面での表示・ソートに使用されます |

**バリデーションルール:**
- バリデーションなし（任意項目）

**バリデーションタイミング:**
- なし（任意項目）

**保存形式:**
- フロントエンド: datetime-local形式（YYYY-MM-DDTHH:mm）
- API送信時: ISO 8601形式（YYYY-MM-DDTHH:mm:ss.sssZ）
- データベース: TIMESTAMPTZ型

---

### 3.2 商品情報

**重要**: 現在の実装では商品名、商品説明、開始価格をサポート。カテゴリ、詳細情報、メディアは後のフェーズで実装予定。

#### 3.2.1 商品名

| 項目 | 内容 |
|------|------|
| **ラベル** | 商品名 * |
| **入力形式** | テキスト入力 |
| **プレースホルダー** | 例: ディープインパクト産駒 |
| **必須/任意** | 必須 |
| **最大文字数** | 200文字 |

**バリデーションルール:**
1. 空欄の場合: 「商品名を入力してください」
2. 200文字を超える場合: 「商品名は200文字以内で入力してください」

#### 3.2.2 商品説明

| 項目 | 内容 |
|------|------|
| **ラベル** | 商品説明 |
| **入力形式** | テキストエリア（複数行） |
| **プレースホルダー** | 商品の詳細情報を入力してください |
| **必須/任意** | 任意 |
| **最大文字数** | 2000文字 |

**バリデーションルール:**
1. 2000文字を超える場合: 「説明は2000文字以内で入力してください」

#### 3.2.3 開始価格

| 項目 | 内容 |
|------|------|
| **ラベル** | 開始価格 |
| **入力形式** | 数値入力 |
| **プレースホルダー** | 例: 5000000 |
| **必須/任意** | 任意 |
| **単位** | ポイント |
| **最小値** | 1 |

**バリデーションルール:**
1. 入力がある場合、1以上の整数であること: 「開始価格は1以上で入力してください」

**説明:**
- オークション作成時に設定可能（任意）
- 未設定の場合はオークション開始前に別途設定が必要
- items.starting_priceカラムに保存される

---

### 3.3 カテゴリ別詳細情報（metadata）※将来実装

**注意**: 以下の項目は将来実装予定です。現在の実装フェーズでは不要です。

#### 3.3.1 競走馬（horse）の場合（将来実装）

| フィールド | データ型 | 必須 | 説明 | 例 |
|-----------|---------|------|------|-----|
| birth_date | DATE | × | 生年月日 | 2022-03-15 |
| gender | STRING | × | 性別（male/female/gelding） | male |
| coat_color | STRING | × | 毛色 | 栗毛 |
| father | STRING | × | 父馬名 | ディープインパクト |
| mother | STRING | × | 母馬名 | ジェンティルドンナ |
| breeder | STRING | × | 生産者 | ノーザンファーム |
| pedigree.father_line | STRING | × | 父系統 | サンデーサイレンス系 |
| pedigree.mother_father | STRING | × | 母父馬名 | ステイゴールド |
| measurements.height | INTEGER | × | 体高（cm） | 160 |
| measurements.chest | INTEGER | × | 胸囲（cm） | 185 |
| measurements.cannon | FLOAT | × | 管囲（cm） | 20.5 |

**JSON保存形式:**
```json
{
  "category": "horse",
  "birth_date": "2022-03-15",
  "gender": "male",
  "coat_color": "栗毛",
  "father": "ディープインパクト",
  "mother": "ジェンティルドンナ",
  "breeder": "ノーザンファーム",
  "pedigree": {
    "father_line": "サンデーサイレンス系",
    "mother_father": "ステイゴールド"
  },
  "measurements": {
    "height": 160,
    "chest": 185,
    "cannon": 20.5
  }
}
```

**バリデーションルール:**
- 体高: 100-200cmの範囲
- 胸囲: 100-250cmの範囲
- 管囲: 10-30cmの範囲

#### 3.3.2 美術品（art）の場合（将来実装）

| フィールド | データ型 | 必須 | 説明 | 例 |
|-----------|---------|------|------|-----|
| artist | STRING | × | 作家名 | 山田太郎 |
| year | STRING | × | 制作年 | 2023 |
| technique | STRING | × | 技法 | 油彩・キャンバス |
| dimensions | STRING | × | サイズ | 100cm × 80cm |
| condition | STRING | × | 状態 | 良好 |

**JSON保存形式:**
```json
{
  "category": "art",
  "artist": "山田太郎",
  "year": "2023",
  "technique": "油彩・キャンバス",
  "dimensions": "100cm × 80cm",
  "condition": "良好"
}
```

#### 3.3.3 車両（vehicle）の場合（将来実装）

| フィールド | データ型 | 必須 | 説明 | 例 |
|-----------|---------|------|------|-----|
| make | STRING | × | メーカー | Toyota |
| model | STRING | × | モデル | Land Cruiser |
| year | INTEGER | × | 年式 | 2023 |
| mileage | INTEGER | × | 走行距離（km） | 5000 |
| condition | STRING | × | 状態 | 良好 |

**JSON保存形式:**
```json
{
  "category": "vehicle",
  "make": "Toyota",
  "model": "Land Cruiser",
  "year": 2023,
  "mileage": 5000,
  "condition": "良好"
}
```

#### 3.3.4 その他（other）の場合（将来実装）

| フィールド | データ型 | 必須 | 説明 |
|-----------|---------|------|------|
| details | STRING | × | 自由記述 |

**JSON保存形式:**
```json
{
  "category": "other",
  "details": "その他の商品詳細情報"
}
```

---

### 3.4 メディアアップロード（将来実装）

**注意**: 以下の項目は将来実装予定です。現在の実装フェーズでは不要です。

#### 3.4.1 画像ファイル（将来実装）

| 項目 | 内容 |
|------|------|
| **対応形式** | JPEG, PNG, WebP |
| **最大サイズ** | 5MB/枚 |
| **最大枚数** | 10枚/商品 |
| **推奨サイズ** | 1200px × 1200px以上 |

**バリデーションルール:**
1. 対応形式以外: 「対応していないファイル形式です」
2. サイズ超過: 「ファイルサイズは5MB以下にしてください」
3. 枚数超過: 「画像は10枚までアップロードできます」

#### 3.4.2 動画ファイル（将来実装）

| 項目 | 内容 |
|------|------|
| **対応形式** | MP4, WebM |
| **最大サイズ** | 100MB/本 |
| **最大本数** | 3本/商品 |
| **推奨解像度** | 1920px × 1080px（フルHD） |

**バリデーションルール:**
1. 対応形式以外: 「対応していないファイル形式です」
2. サイズ超過: 「ファイルサイズは100MB以下にしてください」
3. 本数超過: 「動画は3本までアップロードできます」

#### 3.4.3 表示順序（将来実装）

- ドラッグ&ドロップで順序変更可能
- 最初の画像がメイン画像として一覧表示に使用される
- `display_order`カラムに0から順に採番（0, 1, 2, ...）

---

## 4. 処理フロー

### 4.1 初期表示フロー

```
[ユーザー操作]
  ↓
1. `/admin/auctions/new`にアクセス
  ↓
2. フロントエンドで認証チェック
   - JWTトークンの確認
   - ロールが`auctioneer`または`system_admin`であることを確認
  ↓
3. 空のフォームを表示
   - 商品は1つも追加されていない状態
   - [+ 商品を追加]ボタンが表示される
  ↓
4. ユーザーが情報を入力
```

### 4.2 商品追加フロー

```
[ユーザー操作]
  ↓
1. [+ 商品を追加]ボタンをクリック
  ↓
2. フロントエンドで商品フォームを動的に追加
   - 商品番号を自動採番（#1, #2, ...）
   - 商品名と商品説明の入力フィールドを表示
  ↓
3. ユーザーが商品情報を入力
  ↓
4. [削除]ボタンで商品を削除可能
   - 削除確認モーダルを表示
  ↓
5. [▲][▼]ボタンで表示順序を変更可能
   - リスト内で商品の順序を入れ替え
```

### 4.3 オークション作成フロー

```
[ユーザー操作]
  ↓
1. [作成する]ボタンをクリック
  ↓
2. フロントエンドで全フィールドのバリデーション
   - オークションタイトルの必須チェック
   - 商品名の必須チェック（全商品）
  ↓
3. バリデーションエラーがある場合
   - 最初のエラーフィールドにスクロール
   - エラーメッセージを表示
   - 処理を中断
  ↓
4. バリデーション成功の場合
   - バックエンドAPIにリクエスト送信
   - エンドポイント: POST /api/admin/auctions
   - Content-Type: application/json
  ↓
5. バックエンドでデータ登録（トランザクション）
   - auctionsテーブルにオークション登録（status = 'pending'）
   - itemsテーブルに商品登録（lot_number順、nameとdescriptionのみ）
  ↓
6. 成功時
   - 成功メッセージをトースト通知
   - オークション一覧画面（/admin/auctions）へリダイレクト
  ↓
7. 失敗時
   - エラーメッセージを画面上部に表示
   - ユーザー入力を保持
```

### 4.4 下書き保存フロー

```
[ユーザー操作]
  ↓
1. [下書き保存]ボタンをクリック
  ↓
2. フロントエンドで最低限のバリデーション
   - オークションタイトルのみ必須
   - その他の項目は未入力でも保存可能
  ↓
3. バックエンドAPIにリクエスト送信
   - エンドポイント: POST /api/admin/auctions
   - status = 'pending'で保存
  ↓
4. 成功時
   - 「下書きを保存しました」メッセージを表示
   - オークション編集画面（/admin/auctions/:id/edit）へリダイレクト
  ↓
5. 失敗時
   - エラーメッセージを表示
   - ユーザー入力を保持
```

---

## 5. セキュリティ要件

### 5.1 権限チェック

1. **フロントエンド**:
   - Vue Routerのナビゲーションガードで`auctioneer`または`system_admin`ロールを確認
   - ロールが異なる場合は403エラーページへリダイレクト

2. **バックエンド**:
   - すべてのエンドポイントでJWT認証ミドルウェアを適用
   - ロール検証ミドルウェアで`auctioneer`または`system_admin`を要求
   - 権限不足の場合は403エラーを返却

### 5.2 XSSとCSRF対策

- ユーザー入力は自動エスケープ（Vueの機能）
- JWTトークンを使用（Cookieベースではない）
- APIからのレスポンスもエスケープ処理

---

## 6. データベース設計

### 6.1 使用テーブル

**auctionsテーブル**:

| カラム名 | データ型 | NULL | デフォルト | 説明 |
|---------|---------|------|-----------|------|
| id | UUID | NO | gen_random_uuid() | オークションID (主キー) |
| title | VARCHAR(200) | NO | - | タイトル |
| description | TEXT | YES | NULL | 説明 |
| status | VARCHAR(20) | NO | 'pending' | 状態（pending/active/ended/cancelled） |
| started_at | TIMESTAMPTZ | YES | NULL | オークション開始日時（入札者用一覧画面で表示・ソートに使用） |
| created_at | TIMESTAMPTZ | NO | NOW() | 作成日時 |
| updated_at | TIMESTAMPTZ | NO | NOW() | 更新日時 |

**itemsテーブル**:

| カラム名 | データ型 | NULL | デフォルト | 説明 |
|---------|---------|------|-----------|------|
| id | UUID | NO | gen_random_uuid() | 商品ID (主キー) |
| auction_id | UUID | NO | - | オークションID (外部キー) |
| name | VARCHAR(200) | NO | - | 商品名 |
| description | TEXT | YES | NULL | 商品説明 |
| metadata | JSONB | YES | NULL | カテゴリ別詳細情報（将来使用） |
| lot_number | INTEGER | NO | - | ロット番号（同一オークション内での順序） |
| starting_price | BIGINT | YES | NULL | 開始価格（作成時に設定可能） |
| current_price | BIGINT | YES | NULL | 現在の開示価格 |
| winner_id | UUID | YES | NULL | 落札者ID |
| started_at | TIMESTAMPTZ | YES | NULL | 開始日時 |
| ended_at | TIMESTAMPTZ | YES | NULL | 終了日時 |
| created_at | TIMESTAMPTZ | NO | NOW() | 作成日時 |
| updated_at | TIMESTAMPTZ | NO | NOW() | 更新日時 |

**item_mediaテーブル**（将来実装）:

| カラム名 | データ型 | NULL | デフォルト | 説明 |
|---------|---------|------|-----------|------|
| id | BIGSERIAL | NO | - | メディアID (主キー) |
| item_id | UUID | NO | - | 商品ID (外部キー) |
| media_type | VARCHAR(20) | NO | - | メディア種別（image/video） |
| url | VARCHAR(500) | NO | - | メディアURL |
| thumbnail_url | VARCHAR(500) | YES | NULL | サムネイルURL（動画の場合） |
| display_order | INT | NO | 0 | 表示順序 |
| created_at | TIMESTAMPTZ | NO | NOW() | 作成日時 |

### 6.2 トランザクション処理

オークション作成は以下のトランザクションで実行：

```sql
BEGIN;

-- 1. オークション登録
INSERT INTO auctions (id, title, description, status, started_at)
VALUES ($1, $2, $3, 'pending', $4)
RETURNING id;

-- 2. 商品登録（複数）
INSERT INTO items (id, auction_id, name, description, lot_number, starting_price)
VALUES 
  ($1, $auction_id, $2, $3, 0, $4),
  ($5, $auction_id, $6, $7, 1, $8),
  ...;

COMMIT;
```

**エラーハンドリング**:
- いずれかのINSERTが失敗した場合、全体をロールバック
- 外部キー制約違反の検出
- ユニーク制約違反の検出

---

## 7. API仕様

### 7.1 オークション作成API

**エンドポイント**: `POST /api/admin/auctions`

**リクエスト形式**:
```json
{
  "title": "2025年春季競走馬セリ",
  "description": "2025年春季の競走馬セリを開催します。優良血統の馬が多数出品されます。",
  "started_at": "2025-06-15T10:00:00+09:00",
  "items": [
    {
      "name": "ディープインパクト産駒",
      "description": "父ディープインパクト、母ジェンティルドンナの優良血統",
      "lot_number": 0,
      "starting_price": 5000000
    },
    {
      "name": "キタサンブラック産駒",
      "description": "父キタサンブラック、母の父ハーツクライの良血馬",
      "lot_number": 1,
      "starting_price": 3000000
    }
  ]
}
```

**レスポンス形式（成功時）**:
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "title": "2025年春季競走馬セリ",
  "description": "2025年春季の競走馬セリを開催します。優良血統の馬が多数出品されます。",
  "status": "pending",
  "started_at": "2025-06-15T10:00:00+09:00",
  "item_count": 2,
  "created_at": "2025-01-01T10:00:00Z",
  "updated_at": "2025-01-01T10:00:00Z"
}
```

**レスポンス形式（失敗時）**:
```json
{
  "error": "Validation failed",
  "details": [
    {
      "field": "title",
      "message": "Title is required"
    },
    {
      "field": "items[0].name",
      "message": "Item name is required"
    }
  ]
}
```

### 7.2 エラーレスポンス一覧

| HTTPステータス | エラーメッセージ | 発生条件 |
|--------------|----------------|---------|
| 400 Bad Request | Validation failed | バリデーションエラー |
| 401 Unauthorized | Unauthorized | JWT認証失敗 |
| 403 Forbidden | Insufficient permissions | ロールが不適切 |
| 413 Payload Too Large | Request entity too large | リクエスト全体が大きすぎる |
| 500 Internal Server Error | Internal server error | サーバー内部エラー |

---

## 8. バックエンド実装要件

### 8.1 レイヤー構成

**Domain層（データモデル）**:
- Auction構造体（既存）
- Item構造体（既存）
- ItemMedia構造体（既存）
- CreateAuctionRequest構造体（リクエスト）
- CreateAuctionResponse構造体（レスポンス）
- UploadMediaRequest構造体（メディアアップロード）
- UploadMediaResponse構造体（メディアアップロード）

**Repository層（データアクセス）**:
- `CreateAuction()`: オークション登録
- `CreateItems()`: 商品一括登録
- `CreateItemMedia()`: メディア一括登録
- `FindAuctionByID()`: オークション取得（検証用）

**Service層（ビジネスロジック）**:
- `CreateAuction()`: オークション作成処理（トランザクション管理）
- `UploadMedia()`: メディアアップロード処理
- バリデーション（タイトル、商品名、カテゴリ、メディア）
- メディアファイルのS3アップロード
- サムネイル生成（動画の場合）

**Handler層（APIエンドポイント）**:
- `CreateAuctionHandler`: オークション作成エンドポイント
- `UploadMediaHandler`: メディアアップロードエンドポイント
- リクエストボディのパース
- レスポンスの生成

### 8.2 ミドルウェア

- JWT認証ミドルウェア（既存）
- ロール検証ミドルウェア（`auctioneer`または`system_admin`を許可）

### 8.3 使用技術

- **フレームワーク**: Gin
- **ORM**: GORM
- **バリデーション**: go-playground/validator

---

## 9. フロントエンド実装要件

### 9.1 ディレクトリ構成

```
frontend/src/
  views/
    admin/
      AuctionCreateView.vue         # オークション作成画面コンポーネント
  components/
    admin/
      AuctionBasicInfo.vue          # 基本情報入力コンポーネント
      ItemList.vue                  # 商品リストコンポーネント
      ItemForm.vue                  # 商品入力フォームコンポーネント
    ui/
      button.vue                    # ボタン
      input.vue                     # 入力フィールド
      textarea.vue                  # テキストエリア
      label.vue                     # ラベル
      card.vue                      # カード
      alert.vue                     # アラート
      dialog.vue                    # モーダルダイアログ
  services/
    api/
      auctionApi.ts                 # オークションAPI呼び出し
  stores/
    auctionStore.ts                 # オークション状態管理（将来実装）
  utils/
    validation.ts                   # バリデーションヘルパー
  router/
    index.ts                        # ルーティング設定
```

### 9.2 実装コンポーネント

1. **オークション作成画面（AuctionCreateView.vue）**:
   - ページ全体のレイアウト
   - 基本情報、商品リスト、アクションボタンの配置
   - データ送信処理
   - バリデーション統合

2. **基本情報入力コンポーネント（AuctionBasicInfo.vue）**:
   - タイトル入力
   - 説明入力
   - バリデーション

3. **商品リストコンポーネント（ItemList.vue）**:
   - 商品フォームの動的追加・削除
   - 商品順序の変更（ドラッグ&ドロップ）
   - 商品番号の自動採番

4. **商品入力フォームコンポーネント（ItemForm.vue）**:
   - 商品名入力
   - 商品説明入力
   - 順序変更・削除ボタン

5. **オークションAPI Client（auctionApi.ts）**:
   - `createAuction()`: オークション作成
   - エラーハンドリング

6. **オークション状態管理（auctionStore.ts）**（将来実装）:
   - オークション作成データの保持
   - 商品リストの管理
   - 作成処理の実行
   - エラーメッセージの管理

7. **ルーティング設定（router/index.ts）**:
   - `/admin/auctions/new`へのルート定義
   - 認証ガード（`auctioneer`または`system_admin`）

### 9.3 使用技術

- **フレームワーク**: Vue 3（Composition API）
- **UIライブラリ**: Shadcn Vue + Tailwind CSS
- **状態管理**: Pinia（将来実装）
- **HTTP Client**: Axios
- **ルーティング**: Vue Router

---

## 10. 画面遷移

### 10.1 遷移パターン

```
/admin/auctions（オークション一覧）
  ↓
  [+ 新規オークション作成]クリック
  ↓
/admin/auctions/new（オークション作成）
  ↓
  ├─ [作成する]ボタンクリック
  │    ↓
  │  作成成功 → /admin/auctions（オークション一覧）
  │
  ├─ [下書き保存]ボタンクリック
  │    ↓
  │  保存成功 → /admin/auctions/:id/edit（オークション編集）
  │
  └─ [キャンセル]ボタンクリック
       ↓
     /admin/auctions（オークション一覧）
```

### 10.2 認証ガードの動作

1. **未認証ユーザーがアクセスした場合**:
   - `/admin/login`へ自動リダイレクト

2. **bidderロールがアクセスした場合**:
   - 403エラーページを表示

3. **auctioneeerまたはsystem_adminロールの場合**:
   - 正常に作成画面を表示

---

## 11. UIの動作仕様

### 11.1 通常時の動作

1. **初期表示**:
   - 空のフォームを表示
   - [+ 商品を追加]ボタンが表示される

2. **入力中**:
   - フィールドにフォーカスが当たると枠線がハイライト
   - リアルタイムバリデーションは実施しない（onBlur時のみ）

3. **フィールドからフォーカスが外れた時**:
   - バリデーションを実行
   - エラーがあればフィールドの下に赤いテキストで表示

4. **商品追加時**:
   - 新しい商品フォームが下部に追加される
   - スムーズにスクロール（新しい商品フォームへ）

5. **商品削除時**:
   - 削除確認モーダルを表示
   - 確認後、商品フォームを削除
   - 商品番号を再採番

6. **メディアアップロード時**:
   - プログレスバーを表示
   - アップロード完了後、サムネイルを表示

### 11.2 作成処理中の動作

1. **[作成する]ボタンをクリックした時**:
   - すべてのフィールドのバリデーションを実行
   - エラーがあれば処理を中断

2. **API通信中**:
   - ボタンが無効化される
   - ボタンのテキストが「作成中...」に変わる
   - フォーム全体が無効化される（入力不可）

3. **作成成功時**:
   - 成功メッセージをトースト通知（3秒間）
   - オークション一覧へリダイレクト

4. **作成失敗時**:
   - エラーメッセージを画面上部に表示
   - ボタンとフォームが再び有効化される
   - ユーザー入力を保持

---

## 12. レスポンシブデザイン

### 12.1 スマートフォン（767px以下）

- 1カラムレイアウト
- フィールド幅は画面幅100%
- 商品順序変更ボタンは表示しない（順序固定）
- メディアサムネイルは2列表示

### 12.2 タブレット（768px - 1279px）

- 1カラムレイアウト
- フィールド幅は画面幅80%
- 商品順序変更ボタンを表示
- メディアサムネイルは3列表示

### 12.3 PC（1280px以上）

- 1カラムレイアウト、最大幅900px
- すべての機能を表示
- メディアサムネイルは4列表示

---

## 13. アクセシビリティ

### 13.1 キーボード操作

- Tabキー: フィールド間の移動
- Enterキー: フォーム送信（無効化、誤送信を防ぐ）
- Escapeキー: モーダルを閉じる

### 13.2 スクリーンリーダー対応

- すべての入力フィールドにラベルを関連付け
- エラーメッセージをaria-liveで通知
- ボタンに明確なラベルを設定

### 13.3 フォーカス表示

- キーボードフォーカスを明確に表示（青い枠線）

---

## 14. テスト要件

### 14.1 バックエンドテスト

**正常系テスト**:
- 必須項目のみでオークション作成成功
- 全項目入力でオークション作成成功
- 複数商品の登録成功
- 下書き保存成功

**異常系テスト**:
- タイトル未入力でエラー（400エラー）
- 商品名未入力でエラー（400エラー）
- 認証なしでアクセス（401エラー）
- bidderロールでアクセス（403エラー）

### 14.2 フロントエンドテスト

**コンポーネントテスト**:
- AuctionCreateViewが正しくレンダリングされる
- 商品追加ボタンで商品フォームが追加される
- 商品削除ボタンで商品フォームが削除される
- バリデーションエラーが正しく表示される

**統合テスト**:
- オークション作成成功時に一覧へリダイレクトされる
- 下書き保存成功時に編集画面へリダイレクトされる
- エラー時にエラーメッセージが表示される

---

## 15. 環境変数

### 15.1 フロントエンド環境変数

`.env`ファイルに以下の設定が必要:

| 変数名 | 説明 | 例 |
|-------|------|-----|
| VITE_API_BASE_URL | バックエンドAPIのベースURL | http://localhost/api |

---

## 16. 実装手順

### Phase 1: バックエンドAPI（3-4時間）
- [x] Domain層にCreateAuctionRequest、CreateAuctionResponse構造体を定義
- [x] Repository層にCreateAuction、CreateItemsメソッドを実装
- [x] Service層にCreateAuctionロジックを実装（トランザクション管理）
- [x] Handler層にCreateAuctionHandlerを実装
- [x] ルーティング設定とミドルウェア適用
- [ ] 手動テスト（curlまたはPostman）

### Phase 2: フロントエンド基盤（2-3時間）
- [x] auctionApi.tsにcreateAuctionを実装
- [x] router/index.tsに`/admin/auctions/new`ルートを追加
- [x] ルーティング設定（/admin/auctions/new）と認証ガード
- [x] バリデーションヘルパーの実装

### Phase 3: フロントエンドUI（6-8時間）
- [x] AuctionCreateView.vueの実装
- [x] AuctionBasicInfo.vueの実装（タイトル、説明、開始日時）
- [x] ItemList.vueの実装
- [x] ItemForm.vueの実装（商品名、商品説明、開始価格）

### Phase 4: テストと検証（2-3時間）
- [ ] バックエンドユニットテストの作成
- [ ] フロントエンドコンポーネントテストの作成
- [ ] 統合テストの実施
- [ ] レスポンシブデザインの検証

**合計想定時間**: 13-18時間

---

## 17. 成功基準

以下の条件がすべて満たされたら実装完了とします:

- [ ] オークション基本情報を入力できる
- [ ] 商品を追加・削除できる
- [ ] 商品の順序を変更できる
- [ ] 商品名と商品説明を入力できる
- [ ] バリデーションが正しく動作する
- [ ] オークション作成が正しく動作する
- [ ] 下書き保存が正しく動作する
- [ ] 作成成功時にオークション一覧へリダイレクトされる
- [ ] auctioneeerおよびsystem_adminロールのみアクセス可能
- [ ] レスポンシブデザインが正しく動作する
- [ ] すべてのテストが通過する

---

## 18. 次のステップ

この実装完了後、以下の機能を実装予定:

1. **オークション編集画面（1.3.3）**:
   - 既存オークションと商品情報の編集
   - 入札状況表示

2. **オークション（開催中）画面（1.3.4）**:
   - リアルタイムオークション進行画面
   - WebSocket統合
   - 主催者コントロールパネル

3. **商品詳細画面**:
   - 商品単体の詳細表示
   - 開始価格の設定
   - 入札状況の確認

4. **将来の拡張機能**:
   - カテゴリ別詳細情報入力
   - 画像・動画アップロード機能
   - メディア表示順序変更機能

---

## 19. 参考資料

### 19.1 関連ドキュメント

- [画面一覧](../screen_list.md): すべての画面の概要
- [データベース定義](../database_definition.md): テーブル構造の詳細
- [アーキテクチャ](../architecture.md): システム全体のアーキテクチャ
- [オークション一覧実装プラン](auction_list_implementation_plan.md): 類似画面の参考

### 19.2 外部リソース

- [AWS S3 Documentation](https://docs.aws.amazon.com/s3/)
- [VueDraggable Documentation](https://github.com/SortableJS/vue.draggable.next)
- [VueDatePicker Documentation](https://vue3datepicker.com/)

---

**作成者**: GitHub Copilot  
**レビュー状態**: 未レビュー  
**最終更新**: 2025年11月23日
