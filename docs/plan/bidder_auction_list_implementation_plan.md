# 入札者用オークション一覧画面（2.3.1）実装プラン

**作成日**: 2025年11月24日
**対象画面**: 入札者用オークション一覧画面（Bidder Auction List）
**パス**: `/auctions`
**権限**: 未ログイン可（ログイン済み入札者は追加情報表示）
**優先度**: 高（フェーズ1: 基本機能）

---

## 1. 概要

### 1.1 目的
入札者がシステム内の公開されたオークションを閲覧し、参加したいオークションを探すための画面です。**未ログインユーザーでも閲覧可能**で、ログイン済み入札者には自分の入札状況などの追加情報が表示されます。

**重要な設計方針**:
- 未ログインユーザーでもオークション一覧を閲覧できる（認証不要）
- ログイン済み入札者には自分の入札状況などの追加情報を表示
- 管理者用オークション一覧（1.3.1）とは異なり、入札者視点の情報のみ表示
- `pending`状態のオークションは表示しない（`active`、`ended`、`cancelled`のみ）

### 1.2 対象ユーザー
- **未ログインユーザー**: オークション閲覧のみ可能
- **bidder（入札者）**: オークション閲覧に加え、自分の入札状況が表示される

### 1.3 主要機能
1. オークション一覧表示（タイトル、商品数、状態、作成日時）
2. 商品サムネイル画像の表示
3. 検索機能（タイトル）
4. フィルタリング機能（状態別：active / ended / cancelled）
5. ソート機能（作成日時順、更新日時順）
6. ページネーション（20件/ページ）
7. オークション詳細画面への遷移
8. ログイン済み入札者向け追加表示:
   - 自分の入札状況（入札済み/未入札）
   - 「自分が参加したオークションのみ」フィルタ

---

## 2. 画面レイアウト

### 2.1 画面構成（PC版）

```
┌─────────────────────────────────────────────────────────────┐
│ [ロゴ] オークション一覧                [ログイン] [新規登録]   │
│                                    または [マイページ▾] [ログアウト] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ オークション一覧                                              │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ [検索: __________] 🔍                                    │ │
│ │                                                         │ │
│ │ フィルタ:                                                │ │
│ │ 状態: [すべて▾] [公開中] [終了] [中止]                    │ │
│ │ [ログイン時] 自分が参加したオークション: [✓]              │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ┌───────┐                                               │ │
│ │ │ [画像]│  春季セリ                          [公開中]     │ │
│ │ │サムネイル│  2025年春季の競走馬セリを開催...            │ │
│ │ └───────┘  商品数: 15                                   │ │
│ │            作成日: 2025/01/01                            │ │
│ │            [ログイン時] 入札状況: 入札済み (3/15商品)      │ │
│ │            [詳細を見る]                                  │ │
│ │ ─────────────────────────────────────────────────────── │ │
│ │ ┌───────┐                                               │ │
│ │ │ [画像]│  秋季セリ                          [終了]       │ │
│ │ │サムネイル│  2024年秋季の競走馬セリ（終了）              │ │
│ │ └───────┘  商品数: 20                                   │ │
│ │            作成日: 2024/11/01                            │ │
│ │            [ログイン時] 入札状況: 未参加                  │ │
│ │            [詳細を見る]                                  │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ [スクロール下部に到達すると自動的に次のページを読み込み]        │
│ [ローディング中...] または [すべて表示しました]               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 デザイン要件

- **レイアウト**: カード形式（グリッド2-3列、PCでは3列、タブレットでは2列、スマホでは1列）
- **カード**:
  - 白い背景、薄い影
  - カードホバー時に影が濃くなる
  - サムネイル画像: 16:9比率、オブジェクトフィット: cover
  - タイトル: 大きめのフォント（20px）、太字
  - 説明: 最大2行で省略表示（...）
- **バッジ**:
  - `active`: 緑バッジ「公開中」
  - `ended`: 青バッジ「終了」
  - `cancelled`: 赤バッジ「中止」
- **検索フィールド**: 上部に配置、アイコン付き
- **フィルタ**: ドロップダウン形式、シンプルな選択肢
- **ボタン**: 青系（primary）、角丸、ホバー時に色が濃くなる

---

## 3. 表示項目の仕様

### 3.1 カード表示内容

| 項目 | データ型 | 説明 | 表示形式 | 表示条件 |
|------|---------|------|---------|---------|
| **サムネイル画像** | VARCHAR(255) | オークションの最初の商品の最初の画像 | 画像（16:9） | 常に表示（画像がない場合はプレースホルダー） |
| **タイトル** | VARCHAR(200) | オークションタイトル | テキスト | 常に表示 |
| **説明** | TEXT | オークション説明（省略表示） | テキスト（最大2行） | 常に表示 |
| **状態** | VARCHAR(20) | active(公開中)/ended(終了)/cancelled(中止) | バッジ | 常に表示 |
| **商品数** | INTEGER | 含まれる商品の数 | 「商品数: 15」 | 常に表示 |
| **作成日時** | TIMESTAMP | オークション作成日時 | 「作成日: YYYY/MM/DD」 | 常に表示 |
| **入札状況** | - | 自分の入札状況 | 「入札済み (3/15商品)」または「未参加」 | ログイン時のみ表示 |

### 3.2 バッジの表示仕様

**状態バッジ**:
- `active`: 緑背景、白文字、「公開中」
- `ended`: 青背景、白文字、「終了」
- `cancelled`: 赤背景、白文字、「中止」

**重要**:
- `pending`状態のオークションは入札者には表示されません
- 管理者用一覧とは異なり、入札者には公開されたオークションのみ表示

### 3.3 表示内容の処理

- **説明**: 最大80文字で省略表示、超える場合は「...」を付加
- **サムネイル画像**:
  - オークションに関連付けられた商品の最初の画像（`display_order`が最小）を取得
  - 画像がない場合はプレースホルダー画像を表示
- **商品数**: オークションに関連付けられた`items`テーブルのレコード数をカウント
- **入札状況**（ログイン時のみ）:
  - オークション内の商品に対する自分の入札履歴を確認
  - 入札済み商品数 / 総商品数を表示
  - 入札がない場合は「未参加」と表示
- **日時表示**: タイムゾーンをJST（日本標準時）に変換して表示

---

## 4. 検索・フィルタリング機能

### 4.1 検索機能

**検索対象**:
- オークションタイトル（部分一致）

**検索動作**:
- 検索ボックスに入力後、Enterキー押下またはボタンクリックで検索実行
- 検索結果がない場合: 「該当するオークションが見つかりませんでした」と表示
- 検索クリアボタン（×）で検索条件をリセット

**検索仕様**:
- 大文字・小文字を区別しない（ILIKE検索）
- 前方一致、中間一致、後方一致すべて対象

### 4.2 状態別フィルタ

| フィルタ値 | 表示内容 |
|-----------|---------|
| すべて | すべての公開されたオークションを表示（デフォルト） |
| active | 公開中のオークションのみ表示 |
| ended | 終了したオークションのみ表示 |
| cancelled | 中止されたオークションのみ表示 |

**デフォルト表示**:
- 初期表示では`active`のみ表示（公開中オークション）

### 4.3 自分が参加したオークションフィルタ（ログイン時のみ）

- **チェックボックス**: 「自分が参加したオークションのみ」
- **動作**: チェックONで自分が入札したことのある商品を含むオークションのみ表示
- **実装**: `bids`テーブルから自分の入札履歴を取得し、関連オークションをフィルタ

### 4.4 複合フィルタ

- 状態フィルタと自分が参加したオークションフィルタは組み合わせ可能
- 検索キーワードとフィルタも組み合わせ可能
- 例: 「activeステータス」かつ「自分が参加した」かつ「タイトルに`春`を含む」

---

## 5. ソート機能

### 5.1 ソート可能な項目

| 列名 | ソート順 | デフォルト |
|------|---------|----------|
| 作成日時 | 昇順・降順 | 降順（デフォルト） |
| 更新日時 | 昇順・降順 | - |

### 5.2 ソート動作

- ドロップダウンメニューでソート順を選択
- 初期表示: 作成日時降順（最新のオークションが上に表示）

---

## 6. 無限スクロール（Infinite Scroll）

### 6.1 無限スクロール仕様

- **初回表示件数**: 20件
- **追加読み込み件数**: 20件ずつ
- **トリガー**: ページ下部から200px手前に到達した時点で自動読み込み
- **最大読み込み**: すべてのデータを読み込むまで（制限なし）

### 6.2 ローディング状態

**読み込み中**:
```
┌─────────────────────────────────┐
│  [スピナーアイコン]              │
│  読み込み中...                   │
└─────────────────────────────────┘
```

**すべて読み込み完了**:
```
┌─────────────────────────────────┐
│  すべてのオークションを表示しました │
└─────────────────────────────────┘
```

**データがない場合**:
```
┌─────────────────────────────────┐
│  該当するオークションが            │
│  見つかりませんでした              │
└─────────────────────────────────┘
```

### 6.3 スクロール動作

1. **初期表示**: 最初の20件を表示
2. **スクロール検知**: Intersection Observer APIを使用してページ下部を監視
3. **自動読み込み**: 下部から200px手前に到達したら次の20件を自動的にAPIから取得
4. **データ追加**: 既存のカード一覧の下に新しいカードを追加表示
5. **読み込み完了判定**: `has_more`フラグがfalseになったら読み込み終了メッセージを表示

### 6.4 パフォーマンス最適化

- **重複読み込み防止**: 読み込み中フラグを管理し、重複リクエストを防止
- **スロットリング**: スクロールイベントは200msごとに処理
- **仮想スクロール（将来実装）**: データが1000件を超える場合は仮想スクロールを検討

---

## 7. アクション機能

### 7.1 詳細ボタン

**動作**:
- クリックでオークション詳細画面（2.3.2）へ遷移
- パス: `/auctions/:id`

**表示条件**:
- すべてのオークションで表示

**ログイン状態の扱い**:
- 未ログインユーザー: 詳細画面で閲覧のみ可能
- ログイン済み入札者: 詳細画面で閲覧に加え、`active`状態の場合は入札可能

---

## 8. 処理フロー

### 8.1 初期表示フロー

```
[ユーザー操作]
  ↓
1. `/auctions`にアクセス
  ↓
2. フロントエンドで認証チェック（任意）
   - ログイン済みか確認（JWTトークンの存在）
   - ログイン状態を保持
  ↓
3. バックエンドAPIに一覧取得リクエスト送信
   - デフォルト: offset=0、limit=20、作成日時降順
   - デフォルトフィルタ: active状態のみ
   - ログイン時: JWTトークンをAuthorizationヘッダーに含める（任意）
  ↓
4. バックエンドでデータ取得
   - auctionsテーブルから`status IN ('active', 'ended', 'cancelled')`のレコードを取得
   - 各オークションの商品数をカウント
   - 各オークションのサムネイル画像を取得
   - ログイン時: 各オークションの自分の入札状況を取得
   - 総件数をカウント
   - OFFSET/LIMIT処理（offset=0, limit=20）
   - `has_more`フラグを計算（総件数 > offset + limit）
  ↓
5. フロントエンドで一覧表示
   - カードグリッドにデータをレンダリング
   - ログイン時: 入札状況を表示
   - Intersection Observerを設定してページ下部を監視
```

### 8.2 検索・フィルタ実行フロー

```
[ユーザー操作]
  ↓
1. 検索キーワード入力またはフィルタ選択
  ↓
2. Enterキー押下またはボタンクリック
  ↓
3. フロントエンドで処理
   - 既存の一覧データをクリア
   - offsetを0にリセット
   - クエリパラメータを作成
  ↓
4. バックエンドAPIにリクエスト送信
   - パラメータ: keyword, status, my_auctions, offset=0, limit=20, sort
   - ログイン時: JWTトークンを含める（my_auctions使用時は必須）
  ↓
5. バックエンドでフィルタ処理
   - WHERE句に条件追加
   - ILIKE検索（title）、IN検索（status）
   - my_auctions=trueの場合: bidsテーブルとJOINして自分の入札履歴をフィルタ
  ↓
6. フロントエンドで結果表示
   - 新しいデータで一覧を置き換え
   - スクロール位置をトップにリセット
   - 無限スクロール監視を再開
```

### 8.3 無限スクロール読み込みフロー

```
[スクロール検知]
  ↓
1. ページ下部から200px手前に到達
  ↓
2. フロントエンドで読み込み可能かチェック
   - すでに読み込み中でないか確認
   - has_moreフラグがtrueか確認
  ↓
3. 読み込み中フラグをONに設定
  ↓
4. バックエンドAPIにリクエスト送信
   - 現在のoffsetに20を加算（例: offset=20, limit=20）
   - 現在のフィルタ・検索条件を維持
  ↓
5. バックエンドでデータ取得
   - 指定されたoffsetから20件取得
   - has_moreフラグを計算
  ↓
6. フロントエンドでデータ追加
   - 既存の一覧の下に新しいカードを追加
   - offsetを更新（+20）
   - has_moreフラグを更新
   - 読み込み中フラグをOFFに設定
  ↓
7. has_more=falseの場合
   - 「すべてのオークションを表示しました」メッセージを表示
   - 無限スクロール監視を停止
```

---

## 9. セキュリティ要件

### 9.1 権限チェック

**重要な設計方針**:
- この画面は未ログインユーザーでもアクセス可能
- ログイン済みユーザーには追加情報を表示

1. **フロントエンド**:
   - 認証ガードは不要
   - ログイン状態を確認し、ログイン時のみ追加機能を表示
   - 「自分が参加したオークション」フィルタはログイン時のみ有効

2. **バックエンド**:
   - 一覧取得APIは認証不要
   - ただし、`my_auctions=true`パラメータが指定された場合はJWT認証必須
   - 認証済みの場合のみ入札状況を返却

### 9.2 データアクセス制御

- **未ログインユーザー**: `pending`状態のオークションは非表示
- **ログイン済み入札者**: 自分の入札情報のみ取得可能（他人の入札情報は非表示）

### 9.3 CSRFとXSS対策

- ユーザー入力は自動エスケープ（Vueの機能）
- APIからのレスポンスもエスケープ処理

---

## 10. データベース設計

### 10.1 使用テーブル

**auctionsテーブル**:

| カラム名 | データ型 | 説明 | 制約 |
|---------|---------|------|------|
| id | UUID | オークションID | 主キー |
| title | VARCHAR(200) | タイトル | 必須 |
| description | TEXT | 説明 | 任意 |
| status | VARCHAR(20) | 状態（pending=非公開/active=公開中/ended=終了/cancelled=中止） | 必須、CHECK制約 |
| created_at | TIMESTAMP | 作成日時 | 自動設定 |
| updated_at | TIMESTAMP | 更新日時 | 自動更新 |

**itemsテーブル**:

| カラム名 | データ型 | 説明 | 制約 |
|---------|---------|------|------|
| id | UUID | 商品ID | 主キー |
| auction_id | UUID | オークションID | 外部キー（auctions） |
| name | VARCHAR(200) | 商品名 | 必須 |
| description | TEXT | 商品説明 | 任意 |
| lot_number | INTEGER | ロット番号 | 必須 |
| created_at | TIMESTAMP | 作成日時 | 自動設定 |
| updated_at | TIMESTAMP | 更新日時 | 自動更新 |

**item_mediaテーブル**:

| カラム名 | データ型 | 説明 | 制約 |
|---------|---------|------|------|
| id | UUID | メディアID | 主キー |
| item_id | UUID | 商品ID | 外部キー（items） |
| media_type | VARCHAR(20) | メディアタイプ（image/video） | 必須 |
| url | VARCHAR(255) | メディアURL | 必須 |
| thumbnail_url | VARCHAR(255) | サムネイルURL | 任意 |
| display_order | INTEGER | 表示順序 | 必須、デフォルト0 |
| created_at | TIMESTAMP | 作成日時 | 自動設定 |

**bidsテーブル**（入札履歴、ログイン時の入札状況取得に使用）:

| カラム名 | データ型 | 説明 | 制約 |
|---------|---------|------|------|
| id | UUID | 入札ID | 主キー |
| item_id | UUID | 商品ID | 外部キー（items） |
| bidder_id | UUID | 入札者ID | 外部キー（bidders） |
| price | BIGINT | 入札価格 | 必須、正の整数 |
| bid_at | TIMESTAMP | 入札日時 | 自動設定 |
| is_winning | BOOLEAN | 現在の最高入札かどうか | デフォルト false |

### 10.2 クエリ最適化

**一覧取得クエリ例**（商品数、サムネイル画像を含む）:
```sql
-- 未ログイン時
SELECT
    a.id,
    a.title,
    a.description,
    a.status,
    a.created_at,
    a.updated_at,
    COUNT(DISTINCT i.id) AS item_count,
    (
        SELECT im.thumbnail_url
        FROM items i2
        LEFT JOIN item_media im ON im.item_id = i2.id AND im.media_type = 'image'
        WHERE i2.auction_id = a.id
        ORDER BY i2.lot_number ASC, im.display_order ASC
        LIMIT 1
    ) AS thumbnail_url
FROM auctions a
LEFT JOIN items i ON i.auction_id = a.id
WHERE
    a.status IN ('active', 'ended', 'cancelled')
    AND (a.title ILIKE '%keyword%' OR 'keyword' IS NULL)
    AND (a.status = 'active' OR 'active' IS NULL)
GROUP BY a.id, a.title, a.description, a.status, a.created_at, a.updated_at
ORDER BY a.created_at DESC
LIMIT 20 OFFSET 0;
```

**ログイン時の入札状況を含むクエリ例**:
```sql
-- ログイン時（入札状況を含む）
SELECT
    a.id,
    a.title,
    a.description,
    a.status,
    a.created_at,
    a.updated_at,
    COUNT(DISTINCT i.id) AS item_count,
    (
        SELECT im.thumbnail_url
        FROM items i2
        LEFT JOIN item_media im ON im.item_id = i2.id AND im.media_type = 'image'
        WHERE i2.auction_id = a.id
        ORDER BY i2.lot_number ASC, im.display_order ASC
        LIMIT 1
    ) AS thumbnail_url,
    COUNT(DISTINCT CASE WHEN b.bidder_id = $1 THEN i.id END) AS my_bid_count
FROM auctions a
LEFT JOIN items i ON i.auction_id = a.id
LEFT JOIN bids b ON b.item_id = i.id
WHERE
    a.status IN ('active', 'ended', 'cancelled')
    AND (a.title ILIKE '%keyword%' OR 'keyword' IS NULL)
    AND (a.status = 'active' OR 'active' IS NULL)
    AND (b.bidder_id = $1 OR $2 = false)  -- my_auctions フィルタ
GROUP BY a.id, a.title, a.description, a.status, a.created_at, a.updated_at
ORDER BY a.created_at DESC
LIMIT 20 OFFSET 0;
```

**パフォーマンスノート**:
- サムネイル画像取得のためのサブクエリは、オークション数が多い場合にパフォーマンスに影響する可能性があります
- 必要に応じて、サムネイルURLをキャッシュすることを検討
- `my_auctions`フィルタ使用時は、bidsテーブルとのJOINが発生するため、インデックスを活用

---

## 11. API仕様

### 11.1 一覧取得API

**エンドポイント**: `GET /api/auctions`

**認証**: 任意（認証なしでもアクセス可能、認証ありの場合は入札状況を返却）

**クエリパラメータ**:

| パラメータ | 型 | 必須 | 説明 | 例 |
|-----------|---|------|------|-----|
| offset | integer | × | 取得開始位置（デフォルト: 0） | 0 |
| limit | integer | × | 取得件数（デフォルト: 20、最大: 100） | 20 |
| keyword | string | × | タイトル検索キーワード | 春季 |
| status | string | × | 状態フィルタ（active / ended / cancelled、デフォルト: active） | active |
| my_auctions | boolean | × | 自分が参加したオークションのみ（デフォルト: false、JWTトークン必須） | true |
| sort | string | × | ソート順（created_at_asc / created_at_desc / updated_at_asc / updated_at_desc）（デフォルト: created_at_desc） | created_at_desc |

**リクエスト例（未ログイン、初回読み込み）**:
```
GET /api/auctions?offset=0&limit=20&keyword=春季&status=active&sort=created_at_desc
```

**リクエスト例（未ログイン、追加読み込み）**:
```
GET /api/auctions?offset=20&limit=20&keyword=春季&status=active&sort=created_at_desc
```

**リクエスト例（ログイン時）**:
```
GET /api/auctions?offset=0&limit=20&status=active&my_auctions=true
Authorization: Bearer {JWT_TOKEN}
```

**レスポンス形式（成功時、未ログイン）**:
```json
{
  "auctions": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "title": "春季セリ",
      "description": "2025年春季の競走馬セリを開催します",
      "status": "active",
      "item_count": 15,
      "thumbnail_url": "https://example.com/images/auction1-thumbnail.jpg",
      "created_at": "2024-12-01T10:00:00Z",
      "updated_at": "2025-01-01T10:00:00Z"
    },
    {
      "id": "660e8400-e29b-41d4-a716-446655440001",
      "title": "秋季セリ",
      "description": "2024年秋季の競走馬セリ（終了）",
      "status": "ended",
      "item_count": 20,
      "thumbnail_url": "https://example.com/images/auction2-thumbnail.jpg",
      "created_at": "2024-11-01T10:00:00Z",
      "updated_at": "2024-12-16T15:00:00Z"
    }
  ],
  "pagination": {
    "total": 50,
    "offset": 0,
    "limit": 20,
    "has_more": true
  }
}
```

**レスポンス形式（成功時、ログイン時）**:
```json
{
  "auctions": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "title": "春季セリ",
      "description": "2025年春季の競走馬セリを開催します",
      "status": "active",
      "item_count": 15,
      "thumbnail_url": "https://example.com/images/auction1-thumbnail.jpg",
      "created_at": "2024-12-01T10:00:00Z",
      "updated_at": "2025-01-01T10:00:00Z",
      "my_bid_count": 3
    },
    {
      "id": "660e8400-e29b-41d4-a716-446655440001",
      "title": "秋季セリ",
      "description": "2024年秋季の競走馬セリ（終了）",
      "status": "ended",
      "item_count": 20,
      "thumbnail_url": "https://example.com/images/auction2-thumbnail.jpg",
      "created_at": "2024-11-01T10:00:00Z",
      "updated_at": "2024-12-16T15:00:00Z",
      "my_bid_count": 0
    }
  ],
  "pagination": {
    "total": 50,
    "offset": 0,
    "limit": 20,
    "has_more": true
  }
}
```

**pagination オブジェクトの説明**:
- `total`: 総件数
- `offset`: 現在の取得開始位置
- `limit`: 今回取得した件数
- `has_more`: 追加データがあるかどうか（true: まだデータがある、false: すべて取得済み）

**レスポンス形式（失敗時）**:
```json
{
  "error": "Unauthorized"
}
```

**エラーレスポンス一覧**:

| HTTPステータス | エラーメッセージ | 発生条件 |
|--------------|----------------|---------|
| 400 Bad Request | Invalid query parameters | クエリパラメータが不正 |
| 401 Unauthorized | Unauthorized | my_auctions=trueだがJWT認証がない |
| 500 Internal Server Error | Internal server error | サーバー内部エラー |

---

## 12. バックエンド実装要件

### 12.1 レイヤー構成

**Domain層（データモデル）**:
- BidderAuctionListRequest構造体（リクエストパラメータ）
- BidderAuctionListResponse構造体（レスポンス）
- BidderAuctionSummary構造体（オークション概要情報）
- Pagination構造体（ページネーション情報）

**Repository層（データアクセス）**:
- `FindPublicAuctionsWithFilters()`: 公開されたオークション一覧取得（商品数、サムネイル画像含む、OFFSET/LIMIT対応）
- `FindPublicAuctionsWithBidStatus()`: ログイン時の一覧取得（入札状況含む、OFFSET/LIMIT対応）
- `CountPublicAuctionsWithFilters()`: フィルタ付き総件数取得
- `GetAuctionThumbnail()`: オークションのサムネイル画像取得
- `GetBidderAuctionBidCount()`: 入札者のオークション内入札商品数取得

**Service層（ビジネスロジック）**:
- `GetBidderAuctionList()`: 一覧取得処理（認証状態に応じて異なるデータを返却）
- `CalculateHasMore()`: has_moreフラグの計算（total > offset + limit）
- バリデーション（クエリパラメータ、my_auctionsフィルタ時の認証確認）

**Handler層（APIエンドポイント）**:
- `GetBidderAuctionListHandler`: 一覧取得エンドポイント
- クエリパラメータのパース
- 認証状態の確認（任意）
- レスポンスの生成

### 12.2 ミドルウェア

- JWT認証ミドルウェア（任意、Authorizationヘッダーがある場合のみ適用）

**重要な実装ポイント**:
- 認証ミドルウェアを「任意」にする実装が必要
- JWTトークンがある場合のみ認証を行い、ない場合はスルー
- `my_auctions=true`パラメータが指定された場合は認証必須、認証がない場合は401エラー

### 12.3 使用技術

- **フレームワーク**: Gin
- **ORM**: GORM
- **バリデーション**: go-playground/validator
- **JWT**: golang-jwt/jwt

---

## 13. フロントエンド実装要件

### 13.1 ディレクトリ構成

```
frontend/src/
  views/
    bidder/
      BidderAuctionListView.vue    # 一覧画面コンポーネント
  components/
    bidder/
      AuctionCard.vue              # オークションカードコンポーネント
      AuctionCardGrid.vue          # カードグリッドコンポーネント
      AuctionFilters.vue           # フィルタコンポーネント
      AuctionSearchBar.vue         # 検索バーコンポーネント
      AuctionStatusBadge.vue       # 状態バッジコンポーネント
    ui/
      infinite-scroll.vue          # 無限スクロールコンポーネント
      loading-spinner.vue          # ローディングスピナー
      select.vue                   # セレクトボックス
      input.vue                    # 入力フィールド
      button.vue                   # ボタン
      badge.vue                    # バッジ
      checkbox.vue                 # チェックボックス
  services/
    api/
      bidderAuctionApi.ts          # オークションAPI呼び出し
  stores/
    bidderAuctionStore.ts          # オークション状態管理
  router/
    index.ts                       # ルーティング設定
```

### 13.2 実装コンポーネント

1. **一覧画面（BidderAuctionListView.vue）**:
   - ページ全体のレイアウト
   - 検索バー、フィルタ、カードグリッド、無限スクロールの配置
   - 初回データ取得処理
   - 無限スクロールのセットアップ（Intersection Observer）
   - URLクエリパラメータの管理
   - ログイン状態の確認

2. **オークションカード（AuctionCard.vue）**:
   - オークション情報の表示（サムネイル、タイトル、説明、状態、商品数等）
   - 入札状況の表示（ログイン時のみ）
   - 詳細ボタン
   - カードホバー効果

3. **カードグリッド（AuctionCardGrid.vue）**:
   - レスポンシブグリッドレイアウト（3列/2列/1列）
   - カードの配置
   - データがない場合のメッセージ表示

4. **フィルタコンポーネント（AuctionFilters.vue）**:
   - 状態フィルタ
   - 自分が参加したオークションフィルタ（ログイン時のみ）
   - フィルタ変更時のイベント発火

5. **検索バーコンポーネント（AuctionSearchBar.vue）**:
   - タイトル検索入力
   - 検索実行
   - 検索クリア

6. **無限スクロールコンポーネント（infinite-scroll.vue）**:
   - Intersection Observer APIの実装
   - スクロール位置の監視
   - 追加読み込みトリガー
   - ローディング状態の表示

7. **ローディングスピナー（loading-spinner.vue）**:
   - スピナーアニメーション
   - 読み込み中メッセージ

8. **オークションAPI Client（bidderAuctionApi.ts）**:
   - `getBidderAuctionList()`: 一覧取得（offset/limit対応）
   - エラーハンドリング
   - ログイン状態に応じたヘッダー設定

9. **オークション状態管理（bidderAuctionStore.ts）**:
   - 一覧データの保持（配列）
   - フィルタ・検索条件の保持
   - 無限スクロール状態の保持（offset, has_more, loading）
   - ログイン状態の確認
   - 初回一覧取得処理
   - 追加データ取得処理（既存データに追加）
   - フィルタ変更時のリセット処理
   - エラーメッセージの管理

10. **ルーティング設定（router/index.ts）**:
    - `/auctions`へのルート定義
    - 認証ガードなし（未ログインでもアクセス可能）

### 13.3 使用技術

- **フレームワーク**: Vue 3（Composition API）
- **UIライブラリ**: Shadcn Vue + Tailwind CSS
- **状態管理**: Pinia
- **HTTP Client**: Axios
- **ルーティング**: Vue Router

---

## 14. 画面遷移

### 14.1 遷移パターン

```
[トップページ]
  ↓
/auctions（入札者用オークション一覧）
  ↓
  [詳細ボタン]クリック
  ↓
/auctions/:id（オークション詳細）
```

### 14.2 認証ガードの動作

**重要**: この画面には認証ガードを設定しない

- **未ログインユーザー**: 正常に一覧画面を表示、入札状況は非表示
- **ログイン済み入札者**: 一覧画面に加え、入札状況を表示
- **管理者ロール**: 通常通り閲覧可能（管理者用一覧は別画面）

---

## 15. UIの動作仕様

### 15.1 通常時の動作

1. **初期表示**:
   - デフォルトフィルタ: `active`状態のみ
   - ソート: 作成日時降順
   - offset: 0、最初の20件を読み込み
   - ログイン状態を確認し、ログイン時のみ追加機能を表示
   - Intersection Observerを設定

2. **ホバー時**:
   - カードの影が濃くなる
   - ボタンの色が濃くなる

3. **検索実行時**:
   - 既存の一覧データをクリア
   - offsetを0にリセット
   - スクロール位置をトップに移動
   - ローディング表示（スピナー）

4. **フィルタ変更時**:
   - 既存の一覧データをクリア
   - offsetを0にリセット
   - スクロール位置をトップに移動
   - 該当件数を再計算

5. **スクロール時**:
   - ページ下部から200px手前に到達したら自動的に次のデータを読み込み
   - 読み込み中はスピナーを表示
   - すべて読み込み完了したら「すべてのオークションを表示しました」を表示

### 15.2 ログイン状態による表示切り替え

1. **未ログイン時**:
   - 入札状況は非表示
   - 「自分が参加したオークション」フィルタは非表示
   - ヘッダーに「ログイン」「新規登録」ボタンを表示

2. **ログイン時**:
   - 各カードに入札状況を表示（「入札済み (3/15商品)」または「未参加」）
   - 「自分が参加したオークション」フィルタを表示
   - ヘッダーに「マイページ」「ログアウト」ボタンを表示

---

## 16. レスポンシブデザイン

### 16.1 スマートフォン（767px以下）

- カード形式で表示（1列）
- フィルタはドロワー（引き出し）形式で表示
- 無限スクロールで自動読み込み
- カードの高さは自動調整

### 16.2 タブレット（768px - 1279px）

- カード形式で表示（2列）
- フィルタは折りたたみ可能
- 無限スクロールで自動読み込み

### 16.3 PC（1280px以上）

- カード形式で表示（3列）
- フィルタは常に表示
- 無限スクロールで自動読み込み

---

## 17. アクセシビリティ

### 17.1 キーボード操作

- Tabキー: カード・ボタン間の移動
- Enterキー: ボタンのクリック、検索実行

### 17.2 スクリーンリーダー対応

- カードに`role="article"`を設定
- アクションボタンに`aria-label`を設定
  - 例: `aria-label="春季セリの詳細を表示"`
- 画像に`alt`属性を設定

### 17.3 フォーカス表示

- キーボードフォーカスを明確に表示（青い枠線）
- スキップリンク（ナビゲーションをスキップしてメインコンテンツへ）

---

## 18. テスト要件

### 18.1 バックエンドテスト

**正常系テスト**:
- 未ログインでデフォルトパラメータで一覧取得成功
- ログイン時に入札状況付き一覧取得成功
- フィルタ適用で正しい結果が返却される
- OFFSET/LIMITが正しく機能する
- has_moreフラグが正しく計算される
- ソートが正しく機能する
- `my_auctions=true`で自分が参加したオークションのみ取得

**異常系テスト**:
- `my_auctions=true`だが認証なし（401エラー）
- 不正なクエリパラメータ（400エラー）

### 18.2 フロントエンドテスト

**コンポーネントテスト**:
- BidderAuctionListViewが正しくレンダリングされる
- 未ログイン時に入札状況が非表示
- ログイン時に入札状況が表示される
- フィルタ変更時に正しいAPIリクエストが送信される
- 検索実行時にURLクエリパラメータが更新される
- Intersection Observerが正しく動作する
- スクロール時に追加データが読み込まれる

**統合テスト**:
- 初回一覧取得成功時にデータが表示される
- スクロールで追加データが読み込まれる
- has_more=falseの場合に読み込み完了メッセージが表示される
- フィルタが正しく動作する
- フィルタ変更時にデータがリセットされる
- 未ログイン時とログイン時で表示が切り替わる

---

## 19. 環境変数

バックエンド・フロントエンドともに既存の環境変数を使用（`admin_login_implementation_plan.md`参照）。

---

## 20. 実装手順

### Phase 1: バックエンドAPI（4-5時間）
- [ ] Domain層にBidderAuctionListRequest、BidderAuctionListResponse、BidderAuctionSummary、Pagination構造体を定義
  - [ ] PaginationにはOffset、Limit、Total、HasMoreフィールドを含める
- [ ] Repository層に公開オークション一覧取得、入札状況取得メソッドを実装（OFFSET/LIMIT対応）
- [ ] Service層に一覧取得ロジックを実装（認証状態に応じた分岐）
  - [ ] HasMore計算ロジックを実装
- [ ] Handler層に一覧取得エンドポイントを実装（任意認証、page→offsetに変更）
- [ ] ルーティング設定（認証ミドルウェアを任意に設定）
- [ ] 手動テスト（curlまたはPostman、未ログインとログイン両方、offset/limitテスト）

### Phase 2: フロントエンド基盤（3-4時間）
- [ ] bidderAuctionApi.tsにgetBidderAuctionListを実装（offset/limit対応）
- [ ] bidderAuctionStore.tsに状態管理を実装
  - [ ] offset、has_more、loadingの状態管理
  - [ ] 初回読み込みと追加読み込みのロジック分離
  - [ ] フィルタ変更時のリセット処理
- [ ] ルーティング設定（/auctions、認証ガードなし）

### Phase 3: フロントエンドUI（6-7時間）
- [ ] BidderAuctionListView.vueの実装
  - [ ] Intersection Observerのセットアップ
  - [ ] スクロール検知と追加読み込み
- [ ] AuctionCard.vueの実装
- [ ] AuctionCardGrid.vueの実装
- [ ] AuctionFilters.vueの実装
- [ ] AuctionSearchBar.vueの実装
- [ ] AuctionStatusBadge.vueの実装
- [ ] infinite-scroll.vueの実装（Intersection Observer）
- [ ] loading-spinner.vueの実装
- [ ] レスポンシブデザインの実装

### Phase 4: テストと検証（3-4時間）
- [ ] バックエンドユニットテストの作成
- [ ] フロントエンドコンポーネントテストの作成
- [ ] 統合テストの実施（未ログインとログイン両方）
- [ ] レスポンシブデザインの検証

**合計想定時間**: 16-20時間

---

## 21. 成功基準

以下の条件がすべて満たされたら実装完了とします:

- [ ] 未ログインユーザーでもオークション一覧が表示される
- [ ] ログイン済み入札者には入札状況が表示される
- [ ] 検索機能が正しく動作する
- [ ] 状態フィルタが正しく動作する
- [ ] 自分が参加したオークションフィルタが正しく動作する（ログイン時のみ）
- [ ] ソート機能が正しく動作する
- [ ] 無限スクロールが正しく動作する
- [ ] スクロール時に追加データが自動的に読み込まれる
- [ ] すべてのデータを読み込んだら読み込み完了メッセージが表示される
- [ ] フィルタ変更時にデータがリセットされる
- [ ] 詳細ボタンからオークション詳細画面へ遷移できる
- [ ] サムネイル画像が正しく表示される
- [ ] レスポンシブデザインが正しく動作する
- [ ] すべてのテストが通過する
- [ ] `pending`状態のオークションが表示されない

---

## 22. 次のステップ

この実装完了後、以下の機能を実装予定:

1. **オークション詳細画面（2.3.2）**:
   - オークション閲覧・入札画面
   - WebSocket統合
   - リアルタイム入札機能

2. **入札者ログイン画面（2.1.1）**:
   - 入札者用の認証画面

3. **入札者新規登録画面（2.1.2）**:
   - 入札者アカウント作成

---

## 23. 参考資料

### 23.1 関連ドキュメント

- [画面一覧](../screen_list.md): すべての画面の概要
- [データベース定義](../database_definition.md): テーブル構造の詳細
- [アーキテクチャ](../architecture.md): システム全体のアーキテクチャ
- [管理者用オークション一覧実装プラン](auction_list_implementation_plan.md): 類似画面の参考

---

**作成者**: Claude Code
**レビュー状態**: 未レビュー
**最終更新**: 2025年11月24日
