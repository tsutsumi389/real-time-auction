# システム管理者登録画面（1.2.2）実装プラン

**作成日**: 2025年11月22日
**対象画面**: システム管理者登録画面（Admin Registration）
**パス**: `/admin/admins/new`
**権限**: system_admin
**優先度**: 高（フェーズ2: 管理機能拡充）

---

## 1. 概要

### 1.1 目的
システム管理者が新しい管理者アカウント（システム管理者または主催者）を作成するための画面です。メールアドレス、パスワード、表示名、ロールを入力することで、新規管理者アカウントを登録します。

### 1.2 対象ユーザー
- **system_admin（システム管理者）のみ**: システム管理者のみがこの画面にアクセスできます
- auctioneersは他の管理者を作成する権限を持ちません

### 1.3 主要機能
1. 管理者情報の入力フォーム（メールアドレス、パスワード、表示名、ロール）
2. 入力内容のバリデーション（検証）
3. 重複チェック（メールアドレスの一意性確認）
4. パスワード強度チェックとハッシュ化
5. 登録実行
6. エラーメッセージの表示
7. 登録成功後の管理者一覧への自動遷移

---

## 2. 画面レイアウト

### 2.1 画面構成

```
┌──────────────────────────────────────────────────┐
│  [← 管理者一覧に戻る]                                 │
├──────────────────────────────────────────────────┤
│                                                  │
│  新規管理者登録                                      │
│                                                  │
│  ┌─────────────────────────────────────┐        │
│  │  [エラーメッセージ表示エリア]           │        │
│  └─────────────────────────────────────┘        │
│                                                  │
│  基本情報                                          │
│  ─────────────────────────────────────          │
│                                                  │
│  メールアドレス *                                   │
│  [_________________________________]             │
│  [フィールドエラー]                                 │
│                                                  │
│  表示名                                            │
│  [_________________________________]             │
│  [フィールドエラー]                                 │
│  任意。未入力の場合はメールアドレスが使用されます。      │
│                                                  │
│                                                  │
│  認証情報                                          │
│  ─────────────────────────────────────          │
│                                                  │
│  パスワード *                                      │
│  [_________________________________]             │
│  [フィールドエラー]                                 │
│  8文字以上で入力してください。                        │
│                                                  │
│  パスワード（確認） *                                │
│  [_________________________________]             │
│  [フィールドエラー]                                 │
│  確認のため、もう一度入力してください。                 │
│                                                  │
│                                                  │
│  権限設定                                          │
│  ─────────────────────────────────────          │
│                                                  │
│  ロール *                                          │
│  ( ) システム管理者（system_admin）                  │
│      全権限。ユーザー管理、ポイント管理が可能。          │
│  ( ) 主催者（auctioneer）                           │
│      オークション管理のみ。ユーザー管理は不可。          │
│                                                  │
│  [フィールドエラー]                                 │
│                                                  │
│                                                  │
│  [ キャンセル ]  [    登録する    ]                 │
│                                                  │
└──────────────────────────────────────────────────┘
```

### 2.2 デザイン要件
- **レイアウト**: 左側にサイドバーナビゲーション、右側にフォームエリア
- **フォーム幅**: 最大600px、画面中央に配置
- **セクション区切り**: 「基本情報」「認証情報」「権限設定」で視覚的に区切る
- **必須項目**: ラベルに`*`マークを表示
- **ヘルプテキスト**: フィールドの下に小さいフォントで説明を表示
- **ボタン配置**: フォームの下部に配置、登録ボタンを右側に配置
- **エラー**: 赤い枠線と赤いテキストで表示
- **成功メッセージ**: 登録後はリダイレクト前に一瞬トーストで表示

---

## 3. 入力項目とバリデーション

### 3.1 メールアドレス

| 項目 | 内容 |
|------|------|
| **ラベル** | メールアドレス |
| **入力形式** | テキスト入力（email type） |
| **プレースホルダー** | admin@example.com |
| **必須/任意** | 必須 |
| **最大文字数** | 255文字 |

**バリデーションルール:**
1. 空欄の場合: 「メールアドレスを入力してください」
2. メール形式でない場合: 「メールアドレスの形式が正しくありません」
   - 例: `@`が含まれていない、`.`が含まれていない
3. 重複チェック（API呼び出し）: 「このメールアドレスは既に登録されています」

**バリデーションタイミング:**
- リアルタイム: フィールドからフォーカスが外れた時（onBlur）で形式チェック
- 送信時: 登録ボタンをクリックした時に重複チェック

---

### 3.2 表示名

| 項目 | 内容 |
|------|------|
| **ラベル** | 表示名 |
| **入力形式** | テキスト入力（text type） |
| **プレースホルダー** | システム管理者 |
| **必須/任意** | 任意 |
| **最大文字数** | 100文字 |

**バリデーションルール:**
1. 100文字を超える場合: 「表示名は100文字以内で入力してください」
2. 空欄の場合: バリデーションエラーなし（任意項目）

**バリデーションタイミング:**
- リアルタイム: フィールドからフォーカスが外れた時（onBlur）

**ヘルプテキスト:**
「任意。未入力の場合はメールアドレスが使用されます。」

---

### 3.3 パスワード

| 項目 | 内容 |
|------|------|
| **ラベル** | パスワード |
| **入力形式** | パスワード入力（****で表示） |
| **プレースホルダー** | 8文字以上 |
| **必須/任意** | 必須 |
| **最小文字数** | 8文字 |

**バリデーションルール:**
1. 空欄の場合: 「パスワードを入力してください」
2. 8文字未満の場合: 「パスワードは8文字以上で入力してください」

**バリデーションタイミング:**
- リアルタイム: フィールドからフォーカスが外れた時（onBlur）
- 送信時: 登録ボタンをクリックした時

**ヘルプテキスト:**
「8文字以上で入力してください。」

---

### 3.4 パスワード（確認）

| 項目 | 内容 |
|------|------|
| **ラベル** | パスワード（確認） |
| **入力形式** | パスワード入力（****で表示） |
| **プレースホルダー** | 確認のため再度入力 |
| **必須/任意** | 必須 |
| **最小文字数** | 8文字 |

**バリデーションルール:**
1. 空欄の場合: 「確認用パスワードを入力してください」
2. パスワードと一致しない場合: 「パスワードが一致しません」

**バリデーションタイミング:**
- リアルタイム: フィールドからフォーカスが外れた時（onBlur）
- リアルタイム: パスワードフィールドが変更された時にも再検証

**ヘルプテキスト:**
「確認のため、もう一度入力してください。」

---

### 3.5 ロール

| 項目 | 内容 |
|------|------|
| **ラベル** | ロール |
| **入力形式** | ラジオボタン |
| **選択肢** | system_admin / auctioneer |
| **必須/任意** | 必須 |
| **デフォルト値** | auctioneer |

**選択肢:**
1. **システム管理者（system_admin）**
   - 説明: 全権限。ユーザー管理、ポイント管理が可能。
2. **主催者（auctioneer）**
   - 説明: オークション管理のみ。ユーザー管理は不可。

**バリデーションルール:**
1. 未選択の場合: 「ロールを選択してください」（通常は発生しない、デフォルト値があるため）

**バリデーションタイミング:**
- 送信時: 登録ボタンをクリックした時

---

## 4. 処理フロー

### 4.1 登録処理の流れ

```
[ユーザー操作]
  ↓
1. 各フィールドに情報を入力
  ↓
2. 登録ボタンをクリック
  ↓
3. フロントエンドで入力内容を検証
   - 全フィールドのバリデーション実行
   - エラーがあれば処理を中断、エラー表示
  ↓
4. バックエンドAPIに登録リクエストを送信
  ↓
5. バックエンドで登録処理を実行
   - メールアドレスの重複チェック
   - パスワードのbcryptハッシュ化
   - データベースに新規レコード挿入
   - status = 'active'で作成
  ↓
6. 登録成功の場合
   - 新規作成された管理者情報を返却
  ↓
7. フロントエンドで成功処理
   - 成功トーストメッセージを表示
   - 管理者一覧画面へリダイレクト
```

### 4.2 登録失敗時の処理

| 失敗理由 | 表示メッセージ | HTTPステータス |
|---------|--------------|--------------|
| メールアドレスが既に登録されている | このメールアドレスは既に登録されています | 409 |
| バリデーションエラー | 入力内容に誤りがあります。各フィールドをご確認ください。 | 400 |
| 権限不足（ロールがsystem_adminでない） | この操作を行う権限がありません | 403 |
| サーバーエラー | 登録に失敗しました。もう一度お試しください。 | 500 |
| ネットワークエラー | サーバーに接続できません | - |

---

## 5. セキュリティ要件

### 5.1 パスワードの取り扱い

1. **ハッシュ化**
   - データベースにはパスワードを平文で保存しない
   - bcryptアルゴリズムでハッシュ化してから保存
   - ハッシュ化コスト: 10（セキュリティと速度のバランス）

2. **パスワード強度チェック**
   - 最小8文字以上
   - （将来実装）大文字・小文字・数字・記号の組み合わせチェック

### 5.2 認証・認可

1. **JWT認証**
   - この画面へのアクセスには有効なJWTトークンが必要
   - トークンの検証はミドルウェアで実行

2. **ロール検証**
   - system_adminロールのみアクセス可能
   - auctioneersがアクセスした場合は403エラー

3. **入力サニタイゼーション**
   - ユーザー入力はすべてエスケープ処理
   - SQLインジェクション対策（ORMのプレースホルダー使用）
   - XSS対策（Vueフレームワークの自動保護）

### 5.3 データ整合性

1. **メールアドレスのユニーク性**
   - データベースレベルでユニーク制約
   - APIレベルで重複チェック
   - フロントエンドでもリアルタイムチェック（オプション）

2. **ロールの値制限**
   - system_admin または auctioneer のみ許可
   - データベースレベルでCHECK制約

3. **トランザクション管理**
   - 管理者レコードの挿入はトランザクション内で実行
   - エラー時は自動ロールバック

---

## 6. データベース設計

### 6.1 管理者テーブル（admins）

このテーブルには既に以下のカラムが定義されています（マイグレーション001で作成済み）:

| カラム名 | データ型 | 説明 | 制約 |
|---------|---------|------|------|
| id | BIGSERIAL | 管理者ID（自動採番） | 主キー |
| email | VARCHAR(255) | メールアドレス | 必須、ユニーク、メール形式 |
| password_hash | VARCHAR(255) | パスワードハッシュ | 必須 |
| display_name | VARCHAR(100) | 表示名 | 任意 |
| role | VARCHAR(20) | ロール | 必須、system_admin または auctioneer |
| status | VARCHAR(20) | アカウント状態 | 必須、active / suspended / deleted |
| created_at | TIMESTAMP | 作成日時 | 自動設定 |
| updated_at | TIMESTAMP | 更新日時 | 自動更新 |

### 6.2 新規登録時のデフォルト値

| カラム | デフォルト値 |
|-------|------------|
| id | 自動採番 |
| status | 'active' |
| created_at | 現在時刻 |
| updated_at | 現在時刻 |
| display_name | NULL（未入力の場合） |

---

## 7. API仕様

### 7.1 管理者登録API

**エンドポイント**: `POST /api/admin/admins`

**認証**: 必須（JWT、system_adminロール）

**リクエスト形式**:
```
POST /api/admin/admins
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json

{
  "email": "new_admin@example.com",
  "password": "password123",
  "display_name": "新規管理者",
  "role": "auctioneer"
}
```

**リクエストボディフィールド**:
| フィールド | 型 | 必須 | 説明 |
|-----------|------|------|------|
| email | string | ○ | メールアドレス（255文字以内） |
| password | string | ○ | パスワード（8文字以上） |
| display_name | string | × | 表示名（100文字以内） |
| role | string | ○ | ロール（system_admin or auctioneer） |

**レスポンス形式（成功時）**:
```
HTTP/1.1 201 Created
Content-Type: application/json

{
  "id": 10,
  "email": "new_admin@example.com",
  "display_name": "新規管理者",
  "role": "auctioneer",
  "status": "active",
  "created_at": "2025-11-22T10:30:00Z",
  "updated_at": "2025-11-22T10:30:00Z"
}
```

**レスポンス形式（失敗時）**:
```
HTTP/1.1 409 Conflict
Content-Type: application/json

{
  "error": "Email already exists"
}
```

### 7.2 エラーレスポンス一覧

| HTTPステータス | エラーメッセージ | 発生条件 |
|--------------|----------------|---------|
| 400 Bad Request | Invalid request body | リクエストボディの形式が不正 |
| 400 Bad Request | Email is required | メールアドレスが未入力 |
| 400 Bad Request | Invalid email format | メールアドレスの形式が不正 |
| 400 Bad Request | Password is required | パスワードが未入力 |
| 400 Bad Request | Password must be at least 8 characters | パスワードが8文字未満 |
| 400 Bad Request | Role is required | ロールが未入力 |
| 400 Bad Request | Invalid role | ロールがsystem_admin/auctioneer以外 |
| 401 Unauthorized | Unauthorized | JWT認証失敗 |
| 403 Forbidden | Insufficient permissions | ロールがsystem_adminでない |
| 409 Conflict | Email already exists | メールアドレスが既に登録されている |
| 500 Internal Server Error | Internal server error | サーバー内部エラー |

### 7.3 メールアドレス重複チェックAPI（オプション）

**エンドポイント**: `GET /api/admin/admins/check-email?email=<EMAIL>`

**認証**: 必須（JWT、system_adminロール）

**リクエスト形式**:
```
GET /api/admin/admins/check-email?email=test@example.com
Authorization: Bearer <JWT_TOKEN>
```

**レスポンス形式**:
```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "available": false,
  "message": "Email already exists"
}
```

---

## 8. バックエンド実装要件

### 8.1 レイヤー構成

バックエンドは以下の4層構造で実装します:

1. **Domain層（データモデル）**
   - 管理者情報の構造定義
   - 管理者登録リクエストの構造定義
   - 管理者レスポンスの構造定義

2. **Repository層（データアクセス）**
   - 管理者の新規作成（INSERT）
   - メールアドレスでの検索（重複チェック）
   - トランザクション管理

3. **Service層（ビジネスロジック）**
   - 管理者登録処理の実装
   - メールアドレス重複チェック
   - パスワードのbcryptハッシュ化
   - 入力バリデーション
   - display_nameのデフォルト処理（未入力時はNULL）

4. **Handler層（APIエンドポイント）**
   - HTTPリクエストの受け取り
   - リクエストボディのバリデーション
   - Service層の呼び出し
   - HTTPレスポンスの返却（201 Created）
   - エラーハンドリング

### 8.2 ミドルウェア

1. **JWT認証ミドルウェア**
   - リクエストヘッダーからトークンを取得
   - トークンの有効性を検証
   - トークンからユーザー情報を抽出
   - 認証失敗時は401エラーを返す

2. **ロール検証ミドルウェア**
   - ユーザーのロールを確認
   - system_adminロールであることを検証
   - 権限不足の場合は403エラーを返す

### 8.3 使用技術

- **フレームワーク**: Gin（HTTPルーティング）
- **ORM**: GORM（データベースアクセス）
- **パスワードハッシュ**: bcryptライブラリ
- **バリデーション**: go-playground/validator（構造体タグベース）

---

## 9. フロントエンド実装要件

### 9.1 ディレクトリ構成

```
frontend/src/
  views/
    admin/
      AdminRegistrationView.vue    # 管理者登録画面コンポーネント
  components/
    ui/                            # UIコンポーネント（Shadcn Vue）
      button.vue                   # ボタン
      input.vue                    # 入力フィールド
      label.vue                    # ラベル
      card.vue                     # カード
      alert.vue                    # エラー表示
      radio-group.vue              # ラジオボタングループ
      separator.vue                # セクション区切り線
  services/
    api/
      adminApi.ts                  # 管理者API呼び出し
  utils/
    validation.ts                  # バリデーション関数
  router/
    index.ts                       # ルーティング設定
```

### 9.2 実装コンポーネント

1. **管理者登録画面（AdminRegistrationView.vue）**
   - メールアドレス入力フィールド
   - 表示名入力フィールド
   - パスワード入力フィールド
   - パスワード確認入力フィールド
   - ロール選択（ラジオボタン）
   - 登録ボタン
   - キャンセルボタン（管理者一覧へ戻る）
   - エラーメッセージ表示エリア
   - バリデーション処理
   - API呼び出し

2. **管理者API Client（adminApi.ts）**
   - 管理者登録API呼び出し
   - メールアドレス重複チェックAPI呼び出し（オプション）
   - HTTPリクエスト/レスポンスの処理
   - エラーハンドリング

3. **バリデーション関数（validation.ts）**
   - メールアドレス形式チェック
   - パスワード強度チェック
   - パスワード一致チェック
   - 文字数制限チェック
   - 必須項目チェック

4. **ルーティング設定（router/index.ts）**
   - `/admin/admins/new`へのルート定義
   - 認証ガード（未認証時のリダイレクト）
   - ロール検証ガード（system_adminのみアクセス可能）

### 9.3 使用技術

- **フレームワーク**: Vue 3（Composition API、`<script setup>`）
- **UIライブラリ**: Shadcn Vue + Tailwind CSS
- **状態管理**: Pinia（必要に応じて）
- **HTTP Client**: Axios
- **ルーティング**: Vue Router
- **フォームバリデーション**: VeeValidate（オプション）

---

## 10. 画面遷移

### 10.1 遷移パターン

```
[管理者一覧画面]
  ↓
  新規登録ボタンクリック
  ↓
/admin/admins/new（管理者登録画面）
  ↓
  ┌─ 登録成功
  │  ↓
  │  成功トーストメッセージ表示
  │  ↓
  │  /admin/admins（管理者一覧画面）
  │
  └─ キャンセルボタンクリック
     ↓
     /admin/admins（管理者一覧画面）
```

### 10.2 認証ガードの動作

1. **未認証ユーザーがアクセスした場合**
   - `/admin/login`へ自動リダイレクト

2. **認証済みでもロールがsystem_adminでない場合**
   - `/admin/dashboard`へ自動リダイレクト
   - エラートーストメッセージ: 「この操作を行う権限がありません」

3. **トークンの有効期限が切れた場合**
   - `/admin/login`へ自動リダイレクト
   - エラーメッセージ: 「セッションの有効期限が切れました。再度ログインしてください。」

---

## 11. UIの動作仕様

### 11.1 通常時の動作

1. **初期表示**
   - すべてのフィールドが空の状態
   - ロールのデフォルト値は「主催者（auctioneer）」が選択された状態
   - 登録ボタンは有効

2. **入力中**
   - フィールドにフォーカスが当たると枠線がハイライト
   - パスワードフィールドは****で表示

3. **フィールドからフォーカスが外れた時**
   - バリデーションを実行
   - エラーがあればフィールドの下に赤いテキストで表示
   - エラーがあればフィールドの枠線が赤くなる

4. **ロール選択時**
   - ラジオボタンをクリックすると選択状態が変わる
   - 選択されたロールの説明文が強調表示される

### 11.2 登録処理中の動作

1. **登録ボタンをクリックした時**
   - すべてのフィールドのバリデーションを実行
   - エラーがあれば処理を中断、最初のエラーフィールドにフォーカス

2. **API通信中**
   - 登録ボタンが無効化される
   - ボタンのテキストが「登録中...」に変わる
   - ボタンにローディングスピナーが表示される
   - すべてのフィールドが無効化される（入力不可）

3. **登録成功時**
   - 成功トーストメッセージを表示: 「管理者を登録しました」
   - 管理者一覧画面へリダイレクト

4. **登録失敗時**
   - フォームの上部に赤い背景のエラーメッセージを表示
   - ボタンとフィールドが再び有効化される
   - メールアドレス重複エラーの場合はメールアドレスフィールドに焦点を当てる

### 11.3 キーボード操作

1. **Tabキー**
   - フィールド間を順に移動
   - 移動順: メールアドレス → 表示名 → パスワード → パスワード確認 → ロール → 登録ボタン

2. **Enterキー**
   - パスワード確認フィールドでEnterを押すと登録実行

3. **Escapeキー**
   - 確認モーダルが表示されている場合は閉じる
   - それ以外の場合は何もしない

---

## 12. レスポンシブデザイン

### 12.1 PC（1280px以上）

- フォーム幅: 最大600px、画面中央に配置
- 左側にサイドバーナビゲーション
- ボタン: 右側に配置、幅は自動

### 12.2 タブレット（768px - 1279px）

- フォーム幅: 画面幅の80%
- ハンバーガーメニュー
- ボタン: 下部に配置、幅いっぱい

### 12.3 スマートフォン（767px以下）

- フォーム幅: 画面幅の100%（左右パディング16px）
- ハンバーガーメニュー
- ボタン: 下部に固定配置、幅いっぱい
- セクション区切り線の余白を縮小

---

## 13. アクセシビリティ

### 13.1 キーボード操作

- Tabキー: フィールド間の移動
- Enterキー: 登録実行（パスワード確認フィールドから）
- Escapeキー: モーダルを閉じる
- 矢印キー: ラジオボタン間の移動

### 13.2 スクリーンリーダー対応

- すべての入力フィールドにラベルを関連付け（`<label for="...">`）
- エラーメッセージをaria-liveで通知
- ラジオボタングループにaria-labelledbyを設定
- 必須項目にaria-required="true"を設定
- ヘルプテキストにaria-describedbyを設定

### 13.3 フォーカス表示

- キーボードでフォーカスした要素を明確に表示
- フォーカスリングの色: 青系（高コントラスト）
- タブインデックスを適切に設定（カスタム順序は避ける）

---

## 14. テスト要件

### 14.1 バックエンドテスト

1. **正常系テスト**
   - 有効なデータで管理者を登録できること
   - display_nameが未入力の場合、NULLで登録されること
   - パスワードがbcryptでハッシュ化されること
   - statusが'active'で作成されること
   - レスポンスに新規作成された管理者情報が含まれること

2. **異常系テスト**
   - メールアドレス重複時に409エラーが返ること
   - メールアドレスが未入力時に400エラーが返ること
   - メールアドレスの形式が不正時に400エラーが返ること
   - パスワードが未入力時に400エラーが返ること
   - パスワードが8文字未満時に400エラーが返ること
   - ロールが未入力時に400エラーが返ること
   - ロールが不正な値時に400エラーが返ること

3. **認証・認可テスト**
   - JWT認証なしでアクセスした場合に401エラーが返ること
   - ロールがauctioneersの場合に403エラーが返ること
   - system_adminロールの場合に登録できること

4. **セキュリティテスト**
   - パスワードがレスポンスに含まれないこと
   - SQLインジェクションが防止されること
   - XSS攻撃が防止されること

### 14.2 フロントエンドテスト

1. **コンポーネントテスト**
   - 登録画面が正しくレンダリングされること
   - 各フィールドのバリデーションが正しく動作すること
   - エラーメッセージが正しく表示されること
   - ローディング状態が正しく表示されること

2. **統合テスト**
   - 登録成功時に管理者一覧へリダイレクトされること
   - 登録失敗時にエラーメッセージが表示されること
   - キャンセルボタンで管理者一覧へ戻ること

3. **バリデーションテスト**
   - メールアドレス形式チェックが正しく動作すること
   - パスワード強度チェックが正しく動作すること
   - パスワード一致チェックが正しく動作すること
   - 必須項目チェックが正しく動作すること

4. **E2Eテスト（将来実装）**
   - 実際のブラウザで登録フローを実行
   - 登録後に管理者一覧に新規管理者が表示されること

---

## 15. 環境変数

### 15.1 バックエンド環境変数

`.env`ファイルに以下の設定が必要:

| 変数名 | 説明 | 例 |
|-------|------|-----|
| JWT_SECRET | JWT署名用の秘密鍵（最低32文字） | your-secure-random-secret-key-min-32-chars |
| API_PORT | APIサーバーのポート番号 | 8080 |
| DATABASE_URL | PostgreSQL接続URL | postgres://auction_user:auction_pass@postgres:5432/auction_db |

### 15.2 フロントエンド環境変数

`.env`ファイルに以下の設定が必要:

| 変数名 | 説明 | 例 |
|-------|------|-----|
| VITE_API_BASE_URL | バックエンドAPIのベースURL | http://localhost/api |

---

## 16. 実装手順

### Phase 1: バックエンド基盤（2-3時間）
- [x] データモデルの定義（AdminCreateRequest, AdminResponse）
- [x] Repository層の実装（CreateAdmin, FindByEmail）
- [x] Service層の実装（RegisterAdmin、メール重複チェック、パスワードハッシュ化）
- [x] バリデーション関数の実装

### Phase 2: バックエンドAPI（1-2時間）
- [x] Handler層の実装（POST /api/admin/admins）
- [x] ルーティング設定（system_adminロール検証ミドルウェア適用）
- [x] エラーハンドリングの実装
- [ ] 手動テスト（curlまたはPostman）

### Phase 3: フロントエンド基盤（2-3時間）
- [x] API Clientの実装（adminApi.js）
- [x] バリデーション関数の実装（validation.js）
- [x] ルーティング設定（認証ガード、ロール検証ガード）

### Phase 4: フロントエンドUI（3-4時間）
- [ ] Shadcn UIコンポーネントの追加（RadioGroup、Separator）
- [ ] 管理者登録画面コンポーネントの実装
- [ ] フォームバリデーション機能の実装
- [ ] エラーハンドリングの実装
- [ ] ローディング状態の実装

### Phase 5: テストと検証（2-3時間）
- [ ] バックエンドユニットテストの作成
- [ ] フロントエンドコンポーネントテストの作成
- [ ] 統合テストの実施
- [ ] セキュリティ検証（パスワードハッシュ化、認可チェック）

**合計想定時間**: 10-15時間

---

## 17. 実装時の注意事項

### 17.1 セキュリティに関する注意

1. **絶対にやってはいけないこと**
   - パスワードを平文でデータベースに保存する
   - パスワードをログに出力する
   - パスワードをレスポンスに含める
   - auctioneerロールに管理者登録権限を付与する

2. **必ず守ること**
   - パスワードは必ずbcryptでハッシュ化する
   - system_adminロールのみアクセス可能にする
   - メールアドレスはデータベースレベルでユニーク制約をかける
   - エラーメッセージで詳細な情報を漏らさない（例: 「ユーザーが存在しません」ではなく「メールアドレスまたはパスワードが正しくありません」）

### 17.2 データ整合性

1. **データベースの制約**
   - メールアドレスはユニーク制約で重複を防ぐ
   - ロールは`system_admin`または`auctioneer`のみ許可
   - ステータスは`active`、`suspended`、`deleted`のみ許可
   - すべて既にマイグレーション001で定義済み

2. **トランザクション**
   - 管理者レコードの挿入はトランザクション内で実行
   - エラー時は自動ロールバック

### 17.3 ユーザビリティ

1. **フィードバック**
   - 登録成功時は明確なメッセージを表示
   - エラー時は具体的な修正方法を示す
   - ローディング状態を視覚的に表示

2. **バリデーション**
   - リアルタイムバリデーションで即座にフィードバック
   - 送信前にすべての入力を再検証
   - エラーがある場合は最初のエラーフィールドにフォーカス

---

## 18. 成功基準

以下の条件がすべて満たされたら実装完了とします:

- [ ] system_adminロールでログインして管理者登録画面にアクセスできる
- [ ] 有効なデータで新規管理者を登録できる
- [ ] 登録成功後、管理者一覧画面にリダイレクトされる
- [ ] 登録した管理者が一覧に表示される
- [ ] メールアドレス重複時にエラーメッセージが表示される
- [ ] 入力バリデーションが正しく動作する
- [ ] パスワード確認が正しく動作する
- [ ] ロール選択が正しく動作する
- [ ] auctioneersロールではアクセスできない（403エラー）
- [ ] 未認証ユーザーはアクセスできない（ログイン画面へリダイレクト）
- [ ] レスポンシブデザインが正しく動作する（スマホ/タブレット/PC）
- [ ] キーボード操作で登録できる
- [ ] すべてのテストが通過する

---

## 19. 次のステップ

この実装完了後、以下の機能を実装予定:

1. **システム管理者編集画面（1.2.3）**
   - 既存管理者の情報編集
   - パスワード変更
   - アカウント状態変更（停止・復活）
   - 削除（論理削除）

2. **システム管理者一覧画面（1.2.1）**
   - 管理者の一覧表示
   - 検索・フィルタ機能
   - ソート機能
   - ページネーション

3. **入札者登録画面（1.2.5）**
   - 新規入札者アカウントの作成
   - 初期ポイント付与機能

4. **パスワードリセット機能（将来実装）**
   - メール認証
   - パスワード再設定

---

## 20. 参考資料

### 20.1 関連ドキュメント

- [画面一覧](../screen_list.md): すべての画面の概要
- [データベース定義](../database_definition.md): テーブル構造の詳細
- [アーキテクチャドキュメント](../architecture.md): システム全体の設計
- [管理者ログイン実装プラン](./admin_login_implementation_plan.md): 認証処理の参考

### 20.2 技術仕様

- bcrypt: Adaptive Hash Algorithm
- REST API: RESTful設計原則
- HTTP Status Codes: RFC 7231

---

**作成者**: Claude Code
**レビュー状態**: 未レビュー
**最終更新**: 2025年11月22日
