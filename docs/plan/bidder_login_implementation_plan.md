# 入札者ログイン画面（2.1.1）実装プラン

**作成日**: 2025年11月26日
**対象画面**: 入札者ログイン画面（Bidder Login）
**パス**: `/login`
**権限**: 未認証ユーザー
**優先度**: 最高（MVP必須機能）

---

## 1. 概要

### 1.1 目的
入札者がシステムにログインするための認証画面です。メールアドレスとパスワードを入力することで、本人確認を行い、オークションへの参加権限を付与します。

**重要な設計方針**:
- **管理者と入札者のログイン管理は完全に分離**
- **同じブラウザで管理者と入札者の両方にログイン可能**
- **別々のJWTトークンとlocalStorageキーを使用**

### 1.2 対象ユーザー
- **bidder（入札者）**: オークションに参加し、入札を行うユーザー

### 1.3 主要機能
1. メールアドレスとパスワードの入力
2. ログイン実行（認証処理）
3. 入力内容のバリデーション（検証）
4. エラーメッセージの表示
5. ログイン成功後のオークション一覧への自動遷移

---

## 2. 画面レイアウト

### 2.1 画面構成

```
┌─────────────────────────────────────────┐
│                                         │
│           [ロゴまたはタイトル]              │
│                                         │
│    ┌───────────────────────────┐        │
│    │  ログイン                  │        │
│    │                           │        │
│    │  入札者としてログインして    │        │
│    │  オークションに参加しましょう │        │
│    │                           │        │
│    │  [エラーメッセージ表示エリア] │        │
│    │                           │        │
│    │  メールアドレス             │        │
│    │  [___________________]    │        │
│    │  [フィールドエラー]         │        │
│    │                           │        │
│    │  パスワード                │        │
│    │  [___________________]    │        │
│    │  [フィールドエラー]         │        │
│    │                           │        │
│    │  [    ログインボタン    ]   │        │
│    │                           │        │
│    │  アカウントをお持ちでない方   │        │
│    │  [新規登録はこちら]         │        │
│    │                           │        │
│    └───────────────────────────┘        │
│                                         │
└─────────────────────────────────────────┘
```

### 2.2 デザイン要件
- **背景**: グラデーション（淡い青系またはグレー系）
- **カード**: 中央に配置された白いカード、影付き
- **幅**: スマートフォンでは画面幅100%、PC/タブレットでは最大448px
- **フォント**: シンプルで読みやすいフォント（Shadcn Vueのデフォルト）
- **ボタン**: 幅いっぱい、プライマリカラー、ホバー時に色が変わる
- **エラー**: 赤い枠線と赤いテキストで表示
- **新規登録リンク**: カード下部に配置、テキストリンクスタイル

---

## 3. 入力項目とバリデーション

### 3.1 メールアドレス

| 項目 | 内容 |
|------|------|
| **ラベル** | メールアドレス |
| **入力形式** | テキスト入力（email type） |
| **プレースホルダー** | bidder@example.com |
| **必須/任意** | 必須 |
| **最大文字数** | 255文字 |

**バリデーションルール:**
1. 空欄の場合: 「メールアドレスを入力してください」
2. メール形式でない場合: 「メールアドレスの形式が正しくありません」
   - 例: `@`が含まれていない、`.`が含まれていない

**バリデーションタイミング:**
- リアルタイム: フィールドからフォーカスが外れた時（onBlur）
- 送信時: ログインボタンをクリックした時

---

### 3.2 パスワード

| 項目 | 内容 |
|------|------|
| **ラベル** | パスワード |
| **入力形式** | パスワード入力（****で表示） |
| **プレースホルダー** | 8文字以上 |
| **必須/任意** | 必須 |
| **最小文字数** | 8文字 |

**バリデーションルール:**
1. 空欄の場合: 「パスワードを入力してください」
2. 8文字未満の場合: 「パスワードは8文字以上で入力してください」

**バリデーションタイミング:**
- リアルタイム: フィールドからフォーカスが外れた時（onBlur）
- 送信時: ログインボタンをクリックした時

---

## 4. 認証処理フロー

### 4.1 ログイン処理の流れ

```
[ユーザー操作]
  ↓
1. メールアドレスとパスワードを入力
  ↓
2. ログインボタンをクリック
  ↓
3. フロントエンドで入力内容を検証
  ↓
4. バックエンドAPIにログインリクエストを送信
  ↓
5. バックエンドで認証処理を実行
   - メールアドレスでユーザーを検索（biddersテーブル）
   - パスワードの照合
   - アカウント状態の確認（停止されていないか）
  ↓
6. 認証成功の場合
   - JWTトークン（認証チケット）を発行
   - ユーザー情報を返却
  ↓
7. フロントエンドでトークンを保存
   - localStorage "bidder_token" に保存（管理者とは別キー）
   - localStorage "bidder_user" にユーザー情報を保存
  ↓
8. オークション一覧画面へ自動遷移
```

### 4.2 認証失敗時の処理

| 失敗理由 | 表示メッセージ | HTTPステータス |
|---------|--------------|--------------|
| メールアドレスまたはパスワードが間違っている | メールアドレスまたはパスワードが正しくありません | 401 |
| アカウントが停止されている | アカウントが停止されています | 403 |
| アカウントが削除されている | アカウントが削除されています | 403 |
| サーバーエラー | ログインに失敗しました。もう一度お試しください。 | 500 |
| ネットワークエラー | サーバーに接続できません | - |
| タイムアウト | 接続がタイムアウトしました | - |

---

## 5. セキュリティ要件

### 5.1 パスワードの取り扱い

1. **保存方法**
   - データベースにはパスワードを平文で保存しない
   - bcryptアルゴリズムでハッシュ化（暗号化）してから保存
   - ハッシュ化コスト: 10（セキュリティと速度のバランス）

2. **照合方法**
   - ユーザーが入力したパスワードをハッシュ化
   - データベースに保存されたハッシュと比較
   - 一致すれば認証成功

### 5.2 JWT認証トークン

1. **トークンの役割**
   - ログイン成功後に発行される「認証チケット」
   - 以降のAPI呼び出しで、このトークンを提示することで本人確認を行う

2. **トークンに含まれる情報**
   - ユーザーID（UUID）
   - メールアドレス
   - 表示名
   - ロール（bidder - 固定）
   - ユーザータイプ（bidder）
   - 発行日時
   - 有効期限（24時間）

3. **トークンの保存場所**
   - ブラウザのlocalStorage（ローカルストレージ）に保存
   - **保存キー**: `bidder_token`（管理者は`admin_token`を使用）
   - **ユーザー情報キー**: `bidder_user`（管理者は`admin_user`を使用）
   - **同じブラウザで管理者と入札者の両方にログイン可能**

4. **セキュリティ対策**
   - トークンには署名が付与され、改ざんを検知
   - 有効期限は24時間、期限切れ後は再ログインが必要
   - HTTPS通信でのみトークンを送信（本番環境）

### 5.3 管理者と入札者のセッション分離

**重要な設計ポイント**:

1. **完全に独立したストレージキー**
   - 管理者: `admin_token` / `admin_user`
   - 入札者: `bidder_token` / `bidder_user`

2. **同時ログインが可能**
   - 同じブラウザで管理者と入札者の両方にログイン可能
   - それぞれ独立したトークンを持つ
   - ログアウトも独立して動作

3. **JWT Claimsの識別**
   - `user_type`フィールドで管理者/入札者を識別
   - バックエンドのミドルウェアで適切なロールを検証

4. **API呼び出し時の注意**
   - 入札者用APIは`bidder_token`を使用
   - 管理者用APIは`admin_token`を使用
   - Axiosインスタンスを分離して管理

### 5.4 その他のセキュリティ対策

1. **SQLインジェクション対策**
   - データベースクエリにはプレースホルダーを使用
   - ユーザー入力を直接SQL文に埋め込まない

2. **XSS（クロスサイトスクリプティング）対策**
   - ユーザー入力は自動的にエスケープ処理
   - Vueフレームワークの自動保護機能を使用

3. **CSRF（クロスサイトリクエストフォージェリ）対策**
   - JWTトークンを使用（Cookieは使用しない）

4. **CORS（クロス・オリジン・リソース・シェアリング）設定**
   - 許可されたドメインからのアクセスのみ受け付ける
   - 本番環境では特定のドメインのみ許可

5. **レート制限（将来実装）**
   - ブルートフォース攻撃対策として、1分間に5回までのログイン試行に制限

---

## 6. データベース設計

### 6.1 入札者テーブル（bidders）

このテーブルには既に以下のカラムが定義されています（マイグレーション001で作成済み）:

| カラム名 | データ型 | 説明 | 制約 |
|---------|---------|------|------|
| id | UUID | 入札者ID（自動生成） | 主キー |
| email | VARCHAR(255) | メールアドレス | 必須、ユニーク、メール形式 |
| password_hash | VARCHAR(255) | パスワードハッシュ | 必須 |
| display_name | VARCHAR(100) | 表示名 | 任意 |
| status | VARCHAR(20) | アカウント状態 | 必須、active / suspended / deleted |
| created_at | TIMESTAMPTZ | 作成日時 | 自動設定 |
| updated_at | TIMESTAMPTZ | 更新日時 | 自動更新 |

**インデックス**:
- `idx_bidders_email`: emailカラムにユニークインデックス（status != 'deleted'の場合）
- `idx_bidders_status`: statusカラムにインデックス

### 6.2 テスト用データ

開発環境では、以下のテストアカウントを作成します:

| メールアドレス | パスワード | 表示名 |
|--------------|-----------|--------|
| bidder1@example.com | password123 | テスト入札者1 |
| bidder2@example.com | password123 | テスト入札者2 |
| bidder3@example.com | password123 | テスト入札者3 |

**注意**: 本番環境では絶対に使用しないこと

---

## 7. API仕様

### 7.1 入札者ログインAPI

**エンドポイント**: `POST /api/auth/bidder/login`

**リクエスト形式**:
```
POST /api/auth/bidder/login
Content-Type: application/json

{
  "email": "bidder1@example.com",
  "password": "password123"
}
```

**レスポンス形式（成功時）**:
```
HTTP/1.1 200 OK
Content-Type: application/json

{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "bidder1@example.com",
    "display_name": "テスト入札者1",
    "user_type": "bidder",
    "points": {
      "total": 10000,
      "available": 8000,
      "reserved": 2000
    }
  }
}
```

**レスポンス形式（失敗時）**:
```
HTTP/1.1 401 Unauthorized
Content-Type: application/json

{
  "error": "Invalid email or password"
}
```

### 7.2 エラーレスポンス一覧

| HTTPステータス | エラーメッセージ | 発生条件 |
|--------------|----------------|---------|
| 400 Bad Request | Invalid request body | リクエストボディの形式が不正 |
| 401 Unauthorized | Invalid email or password | メールアドレスまたはパスワードが間違っている |
| 403 Forbidden | Account is suspended | アカウントが停止されている |
| 403 Forbidden | Account is deleted | アカウントが削除されている |
| 500 Internal Server Error | Internal server error | サーバー内部エラー |

---

## 8. バックエンド実装要件

### 8.1 レイヤー構成

バックエンドは以下の4層構造で実装します:

1. **Domain層（データモデル）**
   - 入札者情報の構造定義
   - JWT認証トークンの構造定義（user_typeフィールドを含む）

2. **Repository層（データアクセス）**
   - データベースからの入札者情報取得
   - メールアドレスでの検索機能
   - IDでの検索機能
   - ポイント情報の取得機能

3. **Service層（ビジネスロジック）**
   - 入札者ログイン処理の実装
   - パスワード照合
   - アカウント状態の確認
   - JWTトークンの生成（user_type: "bidder"を含む）
   - トークンの検証（他の画面で使用）

4. **Handler層（APIエンドポイント）**
   - HTTPリクエストの受け取り
   - リクエストボディのバリデーション
   - Service層の呼び出し
   - HTTPレスポンスの返却

### 8.2 既存コードの活用

**既に実装されている管理者ログイン機能を参考にする**:

1. **認証ハンドラ（auth_handler.go）**
   - `AdminLogin`メソッドを参考に`BidderLogin`メソッドを追加
   - 同じ`LoginRequest`構造体を再利用可能
   - エラーハンドリングのパターンは同じ

2. **認証サービス（auth_service.go）**
   - `LoginAdmin`メソッドを参考に`LoginBidder`メソッドを追加
   - JWT生成時に`user_type: "bidder"`を設定
   - bidderRepositoryを使用してデータベースアクセス

3. **JWTサービス（jwt_service.go）**
   - 既存の`GenerateToken`メソッドを利用
   - `user_type`フィールドで管理者/入札者を識別

### 8.3 認証ミドルウェア

既存の認証ミドルウェアを活用:

1. **JWT認証ミドルウェア**
   - リクエストヘッダーからトークンを取得
   - トークンの有効性を検証
   - トークンからユーザー情報を抽出（user_typeで識別）
   - 認証失敗時は401エラーを返す

2. **入札者専用ミドルウェア（新規実装）**
   - `user_type == "bidder"`を検証
   - 入札者以外のアクセスは403エラーを返す

### 8.4 使用技術

- **フレームワーク**: Gin（HTTPルーティング）
- **ORM**: GORM（データベースアクセス）
- **パスワードハッシュ**: bcryptライブラリ
- **JWT**: golang-jwt/jwtライブラリ

---

## 9. フロントエンド実装要件

### 9.1 ディレクトリ構成

```
frontend/src/
  views/
    bidder/
      BidderLoginView.vue        # ログイン画面コンポーネント
  components/
    ui/                          # UIコンポーネント（Shadcn Vue）
      button.vue                 # ボタン
      input.vue                  # 入力フィールド
      label.vue                  # ラベル
      card.vue                   # カード
      alert.vue                  # エラー表示
  services/
    api/
      authApi.ts                 # 認証API呼び出し（bidderAuth機能を追加）
      bidderApi.ts               # 入札者専用API Client
  stores/
    bidderAuthStore.ts           # 入札者認証状態管理（管理者とは別）
  utils/
    bidderAuth.ts                # 入札者トークン管理（bidder_token）
  router/
    index.ts                     # ルーティング設定
```

### 9.2 実装コンポーネント

1. **ログイン画面（BidderLoginView.vue）**
   - メールアドレス入力フィールド
   - パスワード入力フィールド
   - ログインボタン
   - エラーメッセージ表示エリア
   - 新規登録リンク
   - バリデーション処理
   - API呼び出し

2. **認証API Client（authApi.ts / bidderApi.ts）**
   - バックエンドAPIとの通信
   - HTTPリクエスト/レスポンスの処理
   - エラーハンドリング
   - **入札者専用Axiosインスタンス**（bidder_tokenを使用）

3. **トークン管理（bidderAuth.ts）**
   - トークンのlocalStorageへの保存（キー: `bidder_token`）
   - トークンの取得
   - トークンの削除
   - ユーザー情報の保存/取得/削除（キー: `bidder_user`）
   - ログイン状態の確認

4. **認証状態管理（bidderAuthStore.ts）**
   - ログイン処理の実行
   - ログアウト処理
   - ログイン状態の保持
   - ユーザー情報の保持（ポイント情報を含む）
   - エラーメッセージの管理
   - ローディング状態の管理

5. **ルーティング設定（router/index.ts）**
   - `/login`へのルート定義
   - 入札者認証ガード（未認証時のリダイレクト）
   - ログイン済みの場合はオークション一覧へリダイレクト

### 9.3 管理者と入札者のAPI Client分離

**重要な実装ポイント**:

1. **2つの独立したAxiosインスタンス**
   ```
   adminAxios: admin_tokenを使用
   bidderAxios: bidder_tokenを使用
   ```

2. **インターセプター設定**
   - 各Axiosインスタンスは対応するトークンを自動で付与
   - トークンの有効期限切れを検知して自動ログアウト

3. **API Client構成**
   ```
   authApi.ts: 認証API（adminLogin, bidderLogin）
   adminApi.ts: 管理者専用API（admin_tokenを使用）
   bidderApi.ts: 入札者専用API（bidder_tokenを使用）
   ```

### 9.4 使用技術

- **フレームワーク**: Vue 3（Composition API）
- **UIライブラリ**: Shadcn Vue + Tailwind CSS
- **状態管理**: Pinia
- **HTTP Client**: Axios（管理者用と入札者用で分離）
- **ルーティング**: Vue Router

---

## 10. 画面遷移

### 10.1 遷移パターン

```
[未認証状態]
  ↓
/login（ログイン画面）
  ↓
  ログイン成功
  ↓
/auctions（オークション一覧）
```

### 10.2 認証ガードの動作

1. **未認証ユーザーが保護された画面にアクセスした場合**
   - `/login`へ自動リダイレクト

2. **認証済みユーザーがログイン画面にアクセスした場合**
   - `/auctions`へ自動リダイレクト

3. **トークンの有効期限が切れた場合**
   - `/login`へ自動リダイレクト
   - エラーメッセージ: 「セッションの有効期限が切れました。再度ログインしてください。」

4. **管理者と入札者の画面分離**
   - 入札者認証ガード: `bidder_token`の存在と有効性を確認
   - 管理者認証ガード: `admin_token`の存在と有効性を確認
   - それぞれ独立して動作

---

## 11. UIの動作仕様

### 11.1 通常時の動作

1. **初期表示**
   - メールアドレスとパスワードのフィールドが空の状態
   - ログインボタンは有効
   - 新規登録リンクが表示される

2. **入力中**
   - フィールドにフォーカスが当たると枠線がハイライト
   - パスワードは****で表示

3. **フィールドからフォーカスが外れた時**
   - バリデーションを実行
   - エラーがあればフィールドの下に赤いテキストで表示
   - エラーがあればフィールドの枠線が赤くなる

4. **Enterキー押下時**
   - ログインボタンをクリックしたのと同じ動作

### 11.2 ログイン処理中の動作

1. **ログインボタンをクリックした時**
   - すべてのフィールドのバリデーションを実行
   - エラーがあれば処理を中断

2. **API通信中**
   - ログインボタンが無効化される
   - ボタンのテキストが「ログイン中...」に変わる
   - フィールドが無効化される（入力不可）

3. **ログイン成功時**
   - トークンとユーザー情報をlocalStorageに保存（bidder_token / bidder_user）
   - オークション一覧へリダイレクト

4. **ログイン失敗時**
   - カードの上部に赤い背景のエラーメッセージを表示
   - ボタンとフィールドが再び有効化される
   - パスワードフィールドはクリアされる（セキュリティのため）

---

## 12. レスポンシブデザイン

### 12.1 スマートフォン（767px以下）

- カードの幅: 画面幅の100%
- 左右のパディング: 16px
- ログインボタン: 幅いっぱい

### 12.2 タブレット/PC（768px以上）

- カードの幅: 最大448px
- 画面中央に配置
- ログインボタン: カード幅いっぱい

---

## 13. アクセシビリティ

### 13.1 キーボード操作

- Tabキー: フィールド間の移動
- Enterキー: ログイン実行
- Escapeキー: （将来実装）エラーメッセージを閉じる

### 13.2 スクリーンリーダー対応

- すべての入力フィールドにラベルを関連付け
- エラーメッセージをaria-liveで通知
- ボタンに明確なラベルを設定

### 13.3 フォーカス表示

- キーボードでフォーカスした要素を明確に表示
- フォーカスリングの色: プライマリカラー（高コントラスト）

---

## 14. テスト要件

### 14.1 バックエンドテスト

1. **正常系テスト**
   - 正しいメールアドレスとパスワードでログイン成功
   - JWTトークンが正しく発行されること
   - ユーザー情報が正しく返却されること
   - ポイント情報が含まれていること

2. **異常系テスト**
   - 存在しないメールアドレスでログイン失敗（401エラー）
   - 間違ったパスワードでログイン失敗（401エラー）
   - 停止中のアカウントでログイン失敗（403エラー）
   - 削除済みアカウントでログイン失敗（403エラー）

3. **バリデーションテスト**
   - メールアドレス形式が不正（400エラー）
   - パスワードが8文字未満（400エラー）
   - 空のリクエストボディ（400エラー）

4. **セキュリティテスト**
   - パスワードがレスポンスに含まれないこと
   - JWTトークンの署名が正しいこと
   - トークンの有効期限が24時間であること
   - user_typeが"bidder"であること

5. **セッション分離テスト**
   - 管理者トークンと入札者トークンが独立していること
   - 入札者トークンで管理者APIにアクセスできないこと
   - 管理者トークンで入札者APIにアクセスできないこと

### 14.2 フロントエンドテスト

1. **コンポーネントテスト**
   - ログイン画面が正しくレンダリングされること
   - バリデーションが正しく動作すること
   - エラーメッセージが正しく表示されること
   - ローディング状態が正しく表示されること
   - 新規登録リンクが表示されること

2. **統合テスト**
   - ログイン成功時にオークション一覧へリダイレクトされること
   - ログイン失敗時にエラーメッセージが表示されること
   - トークンがlocalStorageに正しいキーで保存されること（bidder_token）
   - ユーザー情報がlocalStorageに正しいキーで保存されること（bidder_user）

3. **セッション分離テスト**
   - 管理者ログイン状態と入札者ログイン状態が独立していること
   - 両方に同時ログイン可能であること
   - それぞれのログアウトが独立して動作すること

4. **E2Eテスト（将来実装）**
   - 実際のブラウザでログインフローを実行
   - ログイン後にオークション一覧が表示されること

---

## 15. 環境変数

### 15.1 バックエンド環境変数

`.env`ファイルに以下の設定が必要:

| 変数名 | 説明 | 例 |
|-------|------|-----|
| JWT_SECRET | JWT署名用の秘密鍵（最低32文字） | your-secure-random-secret-key-min-32-chars |
| API_PORT | APIサーバーのポート番号 | 8080 |
| CORS_ORIGINS | CORS許可オリジン | http://localhost,http://localhost:5173 |
| DATABASE_URL | PostgreSQL接続URL | postgres://auction_user:auction_pass@postgres:5432/auction_db |

### 15.2 フロントエンド環境変数

`.env`ファイルに以下の設定が必要:

| 変数名 | 説明 | 例 |
|-------|------|-----|
| VITE_API_BASE_URL | バックエンドAPIのベースURL | http://localhost/api |

---

## 16. 実装手順

### Phase 1: バックエンド基盤（2-3時間）
- [ ] データモデルの定義（Bidder, JWTClaims with user_type）
- [ ] Repository層の実装（入札者データベースアクセス）
- [ ] Service層の実装（入札者認証ロジック、JWT生成）
- [ ] ミドルウェアの実装（入札者専用認証）

### Phase 2: バックエンドAPI（1-2時間）
- [ ] Handler層の実装（入札者ログインエンドポイント）
- [ ] ルーティング設定（POST /api/auth/bidder/login）
- [ ] Seed dataの作成（テスト入札者アカウント）
- [ ] 手動テスト（curlまたはPostman）

### Phase 3: フロントエンド基盤（2-3時間）
- [ ] 入札者専用API Clientの実装（bidderApi.ts）
- [ ] トークン管理機能の実装（bidderAuth.ts）
- [ ] Pinia Storeの実装（bidderAuthStore.ts）
- [ ] ルーティング設定と入札者認証ガード

### Phase 4: フロントエンドUI（3-4時間）
- [ ] Shadcn UIコンポーネントのセットアップ（既存のものを活用）
- [ ] ログイン画面コンポーネントの実装（BidderLoginView.vue）
- [ ] バリデーション機能の実装
- [ ] エラーハンドリングの実装
- [ ] 新規登録リンクの実装

### Phase 5: セッション分離の検証（1-2時間）
- [ ] 管理者ログインと入札者ログインの独立性確認
- [ ] 同時ログインのテスト
- [ ] API Client分離の検証
- [ ] ローカルストレージの分離確認

### Phase 6: テストと検証（2-3時間）
- [ ] バックエンドユニットテストの作成
- [ ] フロントエンドコンポーネントテストの作成
- [ ] 統合テストの実施
- [ ] セキュリティ検証
- [ ] セッション分離テスト

**合計想定時間**: 11-17時間

---

## 17. 実装時の注意事項

### 17.1 セキュリティに関する注意

1. **絶対にやってはいけないこと**
   - パスワードを平文でデータベースに保存する
   - パスワードをログに出力する
   - JWT_SECRETをGitにコミットする
   - 本番環境でテストアカウントを使用する

2. **必ず守ること**
   - パスワードは必ずbcryptでハッシュ化する
   - JWT_SECRETは環境変数で管理する
   - 本番環境ではHTTPSを使用する
   - エラーメッセージで詳細な情報を漏らさない

### 17.2 セッション分離に関する注意

1. **ローカルストレージキーの管理**
   - 管理者と入札者で別々のキーを使用
   - ハードコードではなく定数で管理
   - 一貫性を保つためにユーティリティ関数を使用

2. **Axiosインスタンスの分離**
   - 管理者用と入札者用のAxiosインスタンスを完全に分離
   - インターセプターで適切なトークンを自動付与
   - エラーハンドリングもそれぞれ独立

3. **認証ガードの実装**
   - 管理者画面と入札者画面で別々のガード関数
   - それぞれ対応するトークンを確認
   - 不正アクセスは適切にリダイレクト

### 17.3 データ整合性

1. **データベースの制約**
   - メールアドレスはユニーク制約で重複を防ぐ
   - ステータスは`active`、`suspended`、`deleted`のみ許可

2. **トランザクション**
   - 複数テーブルの更新は必ずトランザクション内で実行

### 17.4 パフォーマンス

1. **データベースインデックス**
   - emailカラムにユニークインデックスを設定（既に設定済み）

2. **bcryptコスト**
   - コスト10を使用（セキュリティと速度のバランス）

---

## 18. 成功基準

以下の条件がすべて満たされたら実装完了とします:

- [ ] 正しいメールアドレスとパスワードでログインできる
- [ ] ログイン成功後、オークション一覧へ自動遷移する
- [ ] 間違った認証情報でエラーメッセージが表示される
- [ ] 停止中のアカウントでエラーメッセージが表示される
- [ ] 入力バリデーションが正しく動作する
- [ ] JWTトークンがlocalStorageに保存される（bidder_token）
- [ ] ユーザー情報がlocalStorageに保存される（bidder_user）
- [ ] ポイント情報が含まれている
- [ ] 管理者と入札者が同じブラウザで同時ログイン可能
- [ ] それぞれのトークンが独立して管理される
- [ ] 管理者APIと入札者APIが適切に分離されている
- [ ] レスポンシブデザインが正しく動作する（スマホ/PC）
- [ ] キーボード操作でログインできる
- [ ] すべてのテストが通過する

---

## 19. 次のステップ

この実装完了後、以下の機能を実装予定:

1. **入札者登録画面（2.1）**
   - 新規アカウント作成
   - メール検証
   - 初期ポイント付与

2. **オークション一覧画面（2.3.1）**
   - 入札者向けのオークション一覧
   - ステータス別フィルタリング
   - 詳細画面への遷移

3. **ログアウト機能**
   - トークンの削除（bidder_token）
   - ログイン画面へのリダイレクト

4. **ユーザー情報編集画面（2.1.2）**
   - プロフィール編集
   - パスワード変更

5. **リフレッシュトークン（将来実装）**
   - 長期間のセッション維持
   - トークンの自動更新

6. **パスワードリセット（将来実装）**
   - メール認証
   - パスワード再設定機能

---

## 20. 参考資料

### 20.1 関連ドキュメント

- [画面一覧](../screen_list.md): すべての画面の概要
- [データベース定義](../database_definition.md): テーブル構造の詳細
- [アーキテクチャドキュメント](../architecture.md): システム全体の設計
- [管理者ログイン実装プラン](admin_login_implementation_plan.md): 管理者ログインの実装（参考）

### 20.2 技術仕様

- JWT: RFC 7519 - JSON Web Token
- bcrypt: Adaptive Hash Algorithm
- REST API: RESTful設計原則

### 20.3 既存実装の参考コード

- バックエンド管理者ログイン: `backend/internal/handler/auth_handler.go`
- バックエンド認証サービス: `backend/internal/service/auth_service.go`
- JWTサービス: `backend/internal/service/jwt_service.go`
- 認証ミドルウェア: `backend/internal/middleware/auth_middleware.go`

---

**作成者**: Claude Code
**レビュー状態**: 未レビュー
**最終更新**: 2025年11月26日
