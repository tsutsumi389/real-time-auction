# 画面一覧

リアルタイムオークションシステムの全画面を管理者・入札者のロール別に定義します。

## 概要

本システムは3つのロールに対応した画面を提供します：

- **system_admin（システム管理者）**: 全権限、ユーザー管理、ポイント管理
- **auctioneer（主催者）**: オークション管理、商品管理、価格開示
- **bidder（入札者）**: オークション閲覧、入札、ポイント残高確認

---

## 1. 管理者（system_admin / auctioneer）画面

### 1.1 認証・基本機能

#### 1.1.1 ログイン画面
**パス**: `/admin/login`  
**権限**: 未認証ユーザー  
**概要**: 管理者・主催者用のログイン画面

**主要機能**
- メールアドレス・パスワード入力
- ログイン実行（JWT発行）
- バリデーション（入力チェック）
- エラー表示（認証失敗時）

**遷移先**
- ログイン成功 → ダッシュボード（1.1.2）

---

#### 1.1.2 ダッシュボード
**パス**: `/admin/dashboard`  
**権限**: system_admin / auctioneer  
**概要**: 管理者用のホーム画面、全体状況を一覧表示

**主要機能**
- システム統計表示
  - 進行中オークション数
  - 本日の入札数
  - 登録入札者数
  - システム全体のポイント流通量
- 最近のアクティビティ
  - 最新の入札
  - 新規入札者登録
  - 最近終了したオークション
- クイックアクション
  - 新規オークション作成
  - 新規入札者作成（system_adminのみ）
  - ポイント付与（system_adminのみ）

**遷移先**
- オークション一覧（1.3.1）
- 入札者一覧（1.2.1）
- オークション作成（1.3.2）

---

### 1.2 ユーザー管理（system_adminのみ）

#### 1.2.1 システム管理者一覧
**パス**: `/admin/admins`  
**権限**: system_admin  
**概要**: システム管理者・主催者アカウントの一覧表示

**主要機能**
- 管理者一覧表示
  - ID、メールアドレス、表示名、ロール、状態、作成日
- 検索・フィルタ
  - ロール別フィルタ（system_admin / auctioneer）
  - 状態別フィルタ（active / suspended / deleted）
  - メールアドレス検索
- ソート機能
  - 作成日順、メールアドレス順
- ページネーション（20件/ページ）
- アクション
  - 編集ボタン → 編集画面（1.2.3）
  - アカウント停止・復活（status変更）

**遷移先**
- 管理者登録（1.2.2）
- 管理者編集（1.2.3）

---

#### 1.2.2 システム管理者登録
**パス**: `/admin/admins/new`  
**権限**: system_admin  
**概要**: 新規管理者・主催者アカウントの作成

**主要機能**
- 入力フォーム
  - メールアドレス（必須、ユニーク）
  - パスワード（必須、8文字以上、確認入力あり）
  - 表示名（任意）
  - ロール選択（system_admin / auctioneer）
- バリデーション
  - メールアドレス形式チェック
  - パスワード強度チェック
  - 重複チェック
- 登録実行
  - パスワードのbcryptハッシュ化
  - データベース登録

**遷移先**
- 登録成功 → 管理者一覧（1.2.1）
- キャンセル → 管理者一覧（1.2.1）

---

#### 1.2.3 システム管理者編集
**パス**: `/admin/admins/:id/edit`  
**権限**: system_admin  
**概要**: 既存管理者・主催者アカウントの編集

**主要機能**
- 入力フォーム
  - メールアドレス（編集可能）
  - 表示名（編集可能）
  - ロール変更（system_admin ⇔ auctioneer）
  - パスワード変更（任意、変更時のみ入力）
  - 状態変更（active / suspended）
- 更新実行
- 削除機能（論理削除: status = 'deleted'）

**遷移先**
- 更新成功 → 管理者一覧（1.2.1）
- キャンセル → 管理者一覧（1.2.1）

---

#### 1.2.4 入札者一覧
**パス**: `/admin/bidders`  
**権限**: system_admin  
**概要**: 入札者アカウントの一覧表示とポイント管理

**主要機能**
- 入札者一覧表示
  - ID（UUID、短縮表示）、メールアドレス、表示名、状態、作成日
  - ポイント残高（利用可能/予約中/累計）
  - 参加オークション数
  - 落札数
- 検索・フィルタ
  - メールアドレス・表示名検索
  - 状態別フィルタ（active / suspended / deleted）
  - ポイント残高順ソート
- ページネーション（20件/ページ）
- アクション
  - 編集ボタン → 編集画面（1.2.6）
  - ポイント付与ボタン → ポイント付与モーダル
  - ポイント履歴表示 → ポイント履歴モーダル
  - アカウント停止・復活（status変更）

**遷移先**
- 入札者登録（1.2.5）
- 入札者編集（1.2.6）

---

#### 1.2.5 入札者登録
**パス**: `/admin/bidders/new`  
**権限**: system_admin  
**概要**: 新規入札者アカウントの作成

**主要機能**
- 入力フォーム
  - メールアドレス（必須、ユニーク）
  - パスワード（必須、8文字以上、確認入力あり）
  - 表示名（任意）
  - 初期ポイント付与（任意、0以上）
- バリデーション
  - メールアドレス形式チェック
  - パスワード強度チェック
  - 重複チェック
- 登録実行
  - UUID自動生成
  - パスワードのbcryptハッシュ化
  - `bidder_points` レコード自動作成（トリガー）
  - 初期ポイント付与（指定時）

**遷移先**
- 登録成功 → 入札者一覧（1.2.4）
- キャンセル → 入札者一覧（1.2.4）

---

#### 1.2.6 入札者編集
**パス**: `/admin/bidders/:id/edit`  
**権限**: system_admin  
**概要**: 既存入札者アカウントの編集

**主要機能**
- 入力フォーム
  - メールアドレス（編集可能）
  - 表示名（編集可能）
  - パスワード変更（任意、変更時のみ入力）
  - 状態変更（active / suspended）
  - ポイント付与（追加付与のみ、減算不可）
- ポイント残高表示
  - 累計ポイント
  - 利用可能ポイント
  - 予約中ポイント
- 入札履歴表示（最新10件）
- ポイント履歴表示（最新10件）
- 更新実行
- 削除機能（論理削除: status = 'deleted'）

**遷移先**
- 更新成功 → 入札者一覧（1.2.4）
- キャンセル → 入札者一覧（1.2.4）

---

### 1.3 オークション管理

#### 1.3.1 オークション一覧
**パス**: `/admin/auctions`  
**権限**: system_admin / auctioneer  
**概要**: オークションの一覧表示と管理

**主要機能**
- オークション一覧表示
  - ID、タイトル、商品名、状態、現在価格、入札者数、開始日時、終了日時
  - 商品メイン画像（サムネイル）
- 検索・フィルタ
  - タイトル・商品名検索
  - 状態別フィルタ（pending / active / ended / cancelled）
  - 日付範囲フィルタ
- ソート機能
  - 開始日時順、終了日時順、価格順
- ページネーション（20件/ページ）
- アクション
  - 詳細表示 → オークション編集（1.3.3）
  - 開催中オークションへ → オークション画面（1.3.4）
  - 開始ボタン（pending → active）
  - 終了ボタン（active → ended）

**遷移先**
- オークション作成（1.3.2）
- オークション編集（1.3.3）
- オークション（開催中）（1.3.4）

---

#### 1.3.2 オークション作成
**パス**: `/admin/auctions/new`  
**権限**: auctioneer / system_admin  
**概要**: 新規オークションと商品の登録

**主要機能**
- オークション基本情報入力
  - タイトル（必須、200文字以内）
  - 説明（任意、テキストエリア）
- 商品情報入力
  - 商品名（必須、200文字以内）
  - 商品説明（任意、テキストエリア）
  - カテゴリ選択（horse / art / vehicle / other）
  - カテゴリ別詳細情報（JSON）
    - 競走馬の場合: 生年月日、性別、毛色、父馬、母馬、生産者、血統情報、体高等
    - 美術品の場合: 作家、制作年、技法、サイズ、状態
    - 車両の場合: メーカー、モデル、年式、走行距離、状態
- メディアアップロード
  - 画像アップロード（最大10枚、JPG/PNG、5MB以内/枚）
  - 動画アップロード（最大3本、MP4、100MB以内/本）
  - 表示順序の設定（ドラッグ&ドロップ）
  - サムネイル自動生成
- プレビュー機能
- 登録実行（status = 'pending'で作成）

**遷移先**
- 登録成功 → オークション一覧（1.3.1）
- キャンセル → オークション一覧（1.3.1）

---

#### 1.3.3 オークション編集
**パス**: `/admin/auctions/:id/edit`  
**権限**: auctioneer / system_admin  
**概要**: 既存オークションと商品情報の編集

**主要機能**
- オークション基本情報編集
  - タイトル（編集可能、開始前のみ）
  - 説明（編集可能）
  - 状態変更（pending ⇔ cancelled、active → ended）
- 商品情報編集
  - 商品名（編集可能、開始前のみ）
  - 商品説明（編集可能）
  - 詳細情報（JSON）編集
- メディア管理
  - 画像・動画の追加
  - 既存メディアの削除
  - 表示順序の変更
- 入札状況表示
  - 現在価格
  - 総入札数
  - 参加入札者数
  - 最新入札者情報
  - 価格開示履歴
- 更新実行
- 削除機能（論理削除、pendingのみ）

**遷移先**
- 更新成功 → オークション一覧（1.3.1）
- 開催中オークションへ → オークション画面（1.3.4）
- キャンセル → オークション一覧（1.3.1）

---

#### 1.3.4 オークション（開催中の画面）- 管理者用
**パス**: `/admin/auctions/:id/live`  
**権限**: auctioneer / system_admin  
**概要**: オークション進行中の管理画面（WebSocket接続）

**主要機能**
- リアルタイム状態表示
  - 商品情報・メディア表示（画像スライダー、動画再生）
  - 現在の開示価格
  - 現在の入札者情報（最新入札者の表示名、入札時刻）
  - 総入札数
  - 参加入札者数
- 入札履歴リスト（リアルタイム更新）
  - 入札者表示名、入札価格、入札時刻
  - 最新10件を表示、スクロールで過去履歴表示
- 価格開示履歴リスト
  - 開示価格、開示者、開示時刻、入札有無
- 主催者コントロールパネル（auctioneер / system_adminのみ）
  - オークション開始ボタン（pending → active）
    - 開始価格入力フォーム
    - 開始実行 → WebSocket: `auction:started` イベント配信
  - 次の価格開示ボタン（activeのみ）
    - 次の価格入力フォーム
    - 前の価格での入札有無確認
    - 開示実行 → WebSocket: `auction:price_open` イベント配信
  - オークション終了ボタン（activeのみ）
    - 終了確認モーダル
    - 終了実行 → 最後の入札者を落札者として確定
    - ポイント確定処理（reserved → consumed）
    - WebSocket: `auction:ended` イベント配信
- 参加入札者リスト（リアルタイム更新）
  - 接続中の入札者一覧
  - 各入札者の入札回数
  - オンライン状態表示
- システム管理者機能（system_adminのみ）
  - 緊急停止ボタン（status → cancelled）
  - 全入札者への返金処理（reserved → available）

**WebSocketイベント**
- 受信: `auction:join`, `auction:bid`, `auction:leave`
- 送信: `auction:started`, `auction:price_open`, `auction:bid`, `auction:ended`, `auction:cancelled`

**遷移先**
- 終了後 → オークション一覧（1.3.1）

---

## 2. 入札者（bidder）画面

### 2.1 認証・基本機能

#### 2.1.1 ログイン画面
**パス**: `/login`  
**権限**: 未認証ユーザー  
**概要**: 入札者用のログイン画面

**主要機能**
- メールアドレス・パスワード入力
- ログイン実行（JWT発行）
- バリデーション（入力チェック）
- エラー表示（認証失敗時）
- 「パスワードを忘れた場合」リンク（将来実装）

**遷移先**
- ログイン成功 → オークション一覧（2.3.1）

---

#### 2.1.2 ユーザー情報編集
**パス**: `/profile`  
**権限**: bidder  
**概要**: 入札者の個人情報編集画面

**主要機能**
- 基本情報表示
  - 入札者ID（UUID、読み取り専用）
  - 登録日（読み取り専用）
- 編集可能項目
  - メールアドレス（変更可能）
  - 表示名（変更可能）
  - パスワード変更（任意、現在のパスワード確認必須）
- ポイント残高表示（読み取り専用）
  - 累計ポイント
  - 利用可能ポイント
  - 予約中ポイント
- 入札履歴サマリー
  - 総入札回数
  - 参加オークション数
  - 落札回数
  - 総落札金額
- 更新実行

**遷移先**
- 更新成功 → オークション一覧（2.3.1）
- キャンセル → オークション一覧（2.3.1）

---

### 2.2 ポイント管理

#### 2.2.1 ポイント残高・履歴
**パス**: `/points`  
**権限**: bidder  
**概要**: ポイント残高と履歴の確認

**主要機能**
- ポイント残高表示
  - 累計ポイント
  - 利用可能ポイント
  - 予約中ポイント（入札中）
  - 使用済みポイント（落札分）
- ポイント履歴表示
  - 種別（付与/予約/解放/消費/返金）
  - 金額（±表示）
  - 関連オークション名（リンク）
  - 日時
  - 操作後残高
- 検索・フィルタ
  - 種別別フィルタ
  - 日付範囲フィルタ
- ページネーション（50件/ページ）

**遷移先**
- 関連オークション詳細 → オークション（開催中）（2.3.2）

---

### 2.3 オークション閲覧・入札

#### 2.3.1 オークション一覧
**パス**: `/auctions`  
**権限**: bidder  
**概要**: 入札者用のオークション一覧画面

**主要機能**
- オークション一覧表示
  - 商品メイン画像（サムネイル）
  - タイトル、商品名
  - 状態（pending / active / ended）
  - 現在価格（activeのみ）
  - 入札者数
  - 開始日時、終了日時
  - 自分の入札状況（入札済み/未入札）
- 検索・フィルタ
  - タイトル・商品名検索
  - 状態別フィルタ（active / ended）
  - 自分が参加したオークションのみ表示
- ソート機能
  - 開始日時順、価格順
- ページネーション（20件/ページ）
- アクション
  - 詳細表示 → オークション画面（2.3.2）

**遷移先**
- オークション（開催中）（2.3.2）
- ポイント残高 → ポイント残高・履歴（2.2.1）

---

#### 2.3.2 オークション（開催中の画面）- 入札者用
**パス**: `/auctions/:id`  
**権限**: bidder  
**概要**: オークション閲覧・入札画面（WebSocket接続）

**主要機能**
- リアルタイム状態表示
  - 商品情報・メディア表示（画像スライダー、動画再生）
  - 商品詳細情報（カテゴリ別）
  - 現在の開示価格（大きく表示）
  - オークション状態（pending / active / ended）
  - 総入札数
  - 参加入札者数
  - 最新入札者情報（表示名のみ、自分の場合は「あなた」）
- 入札エリア（activeのみ表示）
  - 現在の開示価格表示
  - 自分のポイント残高表示
  - 入札ボタン
    - 開示価格でのみ入札可能（価格入力不可）
    - ポイント不足時は無効化
    - 入札済みの場合は「入札済み」バッジ表示
  - 入札確認モーダル
    - 入札価格、消費ポイント、残りポイント表示
    - 確認・キャンセルボタン
  - 入札実行 → WebSocket: `auction:bid` イベント送信
- 入札履歴リスト（リアルタイム更新）
  - 入札者表示名（自分の場合は「あなた」）、入札価格、入札時刻
  - 最新20件を表示、スクロールで過去履歴表示
- 価格開示履歴リスト
  - 開示価格、開示時刻、入札有無
- オークション終了時
  - 落札者発表（自分が落札した場合は特別表示）
  - ポイント確定表示
  - 次のオークションへのリンク

**WebSocketイベント**
- 送信: `auction:join`, `auction:bid`, `auction:leave`
- 受信: `auction:started`, `auction:price_open`, `auction:bid`, `auction:ended`, `auction:cancelled`

**遷移先**
- オークション一覧（2.3.1）
- ポイント残高・履歴（2.2.1）

---

## 3. 共通機能

### 3.1 ナビゲーションバー

#### 管理者用ナビゲーション
- ロゴ（ダッシュボードへ）
- メニュー
  - ダッシュボード（1.1.2）
  - オークション一覧（1.3.1）
  - 入札者一覧（1.2.4）※ system_adminのみ
  - 管理者一覧（1.2.1）※ system_adminのみ
- ユーザーメニュー（ドロップダウン）
  - ログイン中のユーザー名表示
  - ロール表示（system_admin / auctioneer）
  - ログアウト

#### 入札者用ナビゲーション
- ロゴ（オークション一覧へ）
- メニュー
  - オークション一覧（2.3.1）
  - ポイント残高（2.2.1）
- ユーザーメニュー（ドロップダウン）
  - ログイン中のユーザー名表示
  - 利用可能ポイント表示
  - ユーザー情報編集（2.1.2）
  - ログアウト

### 3.2 エラーページ

#### 404 Not Found
- 存在しないページへのアクセス
- ホームへ戻るリンク

#### 403 Forbidden
- 権限不足
- ログイン画面へ戻るリンク

#### 500 Internal Server Error
- サーバーエラー
- ホームへ戻るリンク

---

## 4. 画面遷移図

```
┌─────────────────────────────────────────────────────────┐
│                     管理者フロー                          │
└─────────────────────────────────────────────────────────┘

/admin/login (1.1.1)
    │
    ├─ ログイン成功
    │
    ↓
/admin/dashboard (1.1.2)
    │
    ├─ オークション管理
    │   ↓
    │   /admin/auctions (1.3.1)
    │       │
    │       ├─ 新規作成
    │       │   ↓
    │       │   /admin/auctions/new (1.3.2)
    │       │
    │       ├─ 編集
    │       │   ↓
    │       │   /admin/auctions/:id/edit (1.3.3)
    │       │
    │       └─ 開催中
    │           ↓
    │           /admin/auctions/:id/live (1.3.4)
    │
    ├─ 入札者管理 (system_adminのみ)
    │   ↓
    │   /admin/bidders (1.2.4)
    │       │
    │       ├─ 新規作成
    │       │   ↓
    │       │   /admin/bidders/new (1.2.5)
    │       │
    │       └─ 編集
    │           ↓
    │           /admin/bidders/:id/edit (1.2.6)
    │
    └─ 管理者管理 (system_adminのみ)
        ↓
        /admin/admins (1.2.1)
            │
            ├─ 新規作成
            │   ↓
            │   /admin/admins/new (1.2.2)
            │
            └─ 編集
                ↓
                /admin/admins/:id/edit (1.2.3)

┌─────────────────────────────────────────────────────────┐
│                     入札者フロー                          │
└─────────────────────────────────────────────────────────┘

/login (2.1.1)
    │
    ├─ ログイン成功
    │
    ↓
/auctions (2.3.1)
    │
    ├─ オークション詳細
    │   ↓
    │   /auctions/:id (2.3.2)
    │       │
    │       ├─ 入札実行 (WebSocket)
    │       │
    │       └─ ポイント確認
    │           ↓
    │           /points (2.2.1)
    │
    └─ ユーザー情報編集
        ↓
        /profile (2.1.2)
```

---

## 5. レスポンシブデザイン対応

### デバイス別レイアウト

#### PC（1280px以上）
- サイドバーナビゲーション
- 2カラムレイアウト（一覧 + 詳細）
- モーダルダイアログ

#### タブレット（768px - 1279px）
- ハンバーガーメニュー
- 1カラムレイアウト
- モーダルダイアログ

#### スマートフォン（767px以下）
- ハンバーガーメニュー
- 1カラムレイアウト
- フルスクリーンモーダル
- 下部固定ボタン（入札ボタン等）

---

## 6. アクセス権限マトリクス

| 画面 | system_admin | auctioneer | bidder | 未認証 |
|------|--------------|------------|--------|--------|
| 管理者ログイン (1.1.1) | ○ | ○ | × | ○ |
| ダッシュボード (1.1.2) | ○ | ○ | × | × |
| 管理者一覧 (1.2.1) | ○ | × | × | × |
| 管理者登録 (1.2.2) | ○ | × | × | × |
| 管理者編集 (1.2.3) | ○ | × | × | × |
| 入札者一覧 (1.2.4) | ○ | × | × | × |
| 入札者登録 (1.2.5) | ○ | × | × | × |
| 入札者編集 (1.2.6) | ○ | × | × | × |
| オークション一覧（管理） (1.3.1) | ○ | ○ | × | × |
| オークション作成 (1.3.2) | ○ | ○ | × | × |
| オークション編集 (1.3.3) | ○ | ○ | × | × |
| オークション（管理） (1.3.4) | ○ | ○ | × | × |
| 入札者ログイン (2.1.1) | × | × | ○ | ○ |
| ユーザー情報編集 (2.1.2) | × | × | ○ | × |
| ポイント残高・履歴 (2.2.1) | × | × | ○ | × |
| オークション一覧（入札者） (2.3.1) | × | × | ○ | × |
| オークション（入札者） (2.3.2) | × | × | ○ | × |

○: アクセス可能  
×: アクセス不可

---

## 7. 実装優先順位

### フェーズ1: 基本機能（MVP）

1. **認証機能**
   - 管理者ログイン (1.1.1)
   - 入札者ログイン (2.1.1)
   - JWT認証ミドルウェア

2. **オークション基本機能**
   - オークション作成 (1.3.2)
   - オークション一覧（管理） (1.3.1)
   - オークション一覧（入札者） (2.3.1)

3. **リアルタイムオークション**
   - オークション（管理） (1.3.4)
   - オークション（入札者） (2.3.2)
   - WebSocket実装

4. **ポイント管理**
   - 入札者作成 (1.2.5)
   - ポイント付与機能（入札者編集 1.2.6）
   - ポイント残高表示 (2.2.1)

### フェーズ2: 管理機能拡充

5. **ユーザー管理**
   - 入札者一覧 (1.2.4)
   - 入札者編集 (1.2.6)
   - 管理者一覧 (1.2.1)
   - 管理者登録・編集 (1.2.2, 1.2.3)

6. **オークション管理拡充**
   - オークション編集 (1.3.3)
   - ダッシュボード (1.1.2)

### フェーズ3: UX向上

7. **ユーザー機能**
   - ユーザー情報編集 (2.1.2)
   - ポイント履歴詳細 (2.2.1)

8. **UI/UX改善**
   - レスポンシブデザイン最適化
   - リアルタイム通知
   - エラーハンドリング強化

---

## 8. 次のステップ

各画面の詳細設計書を以下の順で作成予定：

1. **認証画面**（管理者・入札者ログイン）
2. **オークション作成・編集画面**（管理者）
3. **オークション（開催中）画面**（管理者・入札者）
4. **入札者管理画面**（システム管理者）
5. **ダッシュボード**（管理者）
6. **ユーザー情報編集・ポイント管理画面**（入札者）

各詳細設計書には以下の内容を含めます：

- 画面レイアウト（ワイヤーフレーム）
- 入力項目とバリデーションルール
- APIエンドポイント仕様
- WebSocketイベント仕様（リアルタイム画面のみ）
- 状態管理（Pinia store設計）
- エラーハンドリング
- テストケース

---

**最終更新**: 2025年11月20日  
**バージョン**: 1.0.0
